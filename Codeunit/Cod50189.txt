OBJECT Codeunit 50189 FUSION Sent Service Gen. Act
{
  OBJECT-PROPERTIES
  {
    Date=12/12/11;
    Time=11:08:59;
    Modified=Yes;
    Version List=IMH6.01;
  }
  PROPERTIES
  {
    TableNo=8016720;
    OnRun=BEGIN
            EAISentMQBuffer := Rec;
            Code;
            EAISentMQBuffer.CALCFIELDS("XML Source");
            "XML Source" := EAISentMQBuffer."XML Source";
            Rec := EAISentMQBuffer;
          END;

  }
  CODE
  {
    VAR
      EAISentMQBuffer@1100281004 : Record 8016720;
      EAIXMLDocMgt@1100281000 : Codeunit 8016713;
      Text000@1100281001 : TextConst 'FRA=sch:ListerDocumentsDemande';
      XMLDOMMgt@1100281002 : Codeunit 6224;
      XMLDocMgt@1100281003 : Codeunit 99008514;
      Text001@1100281005 : TextConst 'FRA=http://www.w3.org/2003/05/soap-envelope';
      Text002@1100281006 : TextConst 'FRA=http://www.darva.com/ws/ird/2010/11/schema';
      Text003@1100281007 : TextConst 'FRA=http://www.darva.com/ws/datatype/2010/11';
      FUSIONInterfaceMgt@1100281008 : Codeunit 50181;
      TemNameSpace@1100281010 : Text[250];
      FusNameSpace@1100281009 : Text[250];

    PROCEDURE Code@1100281000();
    VAR
      lXmlDoc@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{F6D90F11-9C73-11D3-B32E-00C04F990BB4}:'Microsoft XML, v6.0'.DOMDocument";
      lSoapBodyNode@1100281003 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lSetServiceNode@1100281008 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lServiceNode@1100281009 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lContactsNode@1100281014 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lContactNode@1100281015 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lCommentListNode@1100281016 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lAttachListNode@1100281020 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lNewNode@1100281010 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lInterfaceSetup@1100281002 : Record 50139;
      lServiceHeader@1100281011 : Record 5900;
      lService@1100281023 : Record 50066;
      lCust@1100281000 : Record 18;
      lContact@1100281013 : Record 5050;
      lEAIPartnerCrossReference@1100281024 : Record 8016748;
      lInStream@1100281005 : InStream;
      lOutStream@1100281001 : OutStream;
      lContactNo@1100281012 : Code[20];
      lIntervLine@1100281007 : Record 50075;
      lServiceHeaderAddress@1100281006 : Record 50068;
      lAdoStream@1100281019 : Automation "{2A75196C-D9EB-4129-B803-931327F72D5C} 2.8:{00000566-0000-0010-8000-00AA006D2EA4}:'Microsoft ActiveX Data Objects 2.8 Library'.Stream";
      lFileName@1100281018 : Text[250];
      lTempFile@1100281017 : File;
      lCode@1100281021 : Record 50079;
      lServiceOrderType@1100281022 : Record 5903;
      lContactContract@1100281025 : Record 50059;
      lGUID@1100281026 : Text[40];
      lFusionReference@1100281027 : Record 50164;
    BEGIN
      //Generation de SOAP XML d'‚mission vers le WS Fusion
      lInterfaceSetup.GET;
      lInterfaceSetup.TESTFIELD("Navision Broadcast Token");

      lServiceHeader.GET(EAISentMQBuffer."Document Type", EAISentMQBuffer."Service Header No.");

      FUSIONInterfaceMgt.CreatFusionWSHeader(lXmlDoc, lSoapBodyNode);
      TemNameSpace := 'http://tempuri.org/';
      FusNameSpace := 'http://schemas.datacontract.org/2004/07/Fusion.EDI';

      FUSIONInterfaceMgt.AddElement(lSoapBodyNode,'tem:SetIntervention','',TemNameSpace,lSetServiceNode);
      FUSIONInterfaceMgt.AddElement(lSetServiceNode,'tem:ticketSiTiers',lInterfaceSetup."Navision Broadcast Token",
          TemNameSpace,lNewNode);

      //Information service
      FUSIONInterfaceMgt.AddElement(lSetServiceNode,'tem:intervention','',TemNameSpace,lServiceNode);

      //<fus:Archiv‚>?</fus:Archiv‚>----------?????????TODO----------
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Archiv‚','false',FusNameSpace,lNewNode);

      //Liste contacts --> <fus:Contacts>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Contacts','',FusNameSpace,lContactsNode);
      //Contacts Liste
      //beneficiaire
      IF lContact.GET(lServiceHeader."Contact No.") THEN BEGIN
        //Contact
        FUSIONInterfaceMgt.AddElement(lContactsNode,'fus:Contact','',FusNameSpace,lContactNode);
        AddContactElement(lContactNode, lContact, 'B‚n‚ficiaire');
      END;

      //GestionnaireDonneurOrdre
      IF lContact.GET(lServiceHeader."Corporate Contact No.") THEN BEGIN
        //Contact
        FUSIONInterfaceMgt.AddElement(lContactsNode,'fus:Contact','',FusNameSpace,lContactNode);
        AddContactElement(lContactNode, lContact, 'GestionnaireDonneurOrdre');
      END;


      //Prestataires
      lIntervLine.SETRANGE("Service Header No.", lServiceHeader."No.");
      IF lIntervLine.FINDFIRST THEN
        REPEAT
          IF lContact.GET(lIntervLine."Provider No.") THEN BEGIN
            //Contact
            FUSIONInterfaceMgt.AddElement(lContactsNode,'fus:Contact','',FusNameSpace,lContactNode);
            AddContactElement(lContactNode, lContact, 'Prestataire');
          END;
        UNTIL lIntervLine.NEXT = 0;

      //Exprert/Annexe
      lServiceHeaderAddress.SETRANGE("Service Header No.", lServiceHeader."No.");
      lServiceHeaderAddress.SETFILTER("Address Type", '=%1|=%2',
        lServiceHeaderAddress."Address Type"::"Annexe Contact", lServiceHeaderAddress."Address Type"::"Expert Contact");
      IF lServiceHeaderAddress.FINDFIRST THEN
        REPEAT
          //Contact
          FUSIONInterfaceMgt.AddElement(lContactsNode,'fus:Contact','',FusNameSpace,lContactNode);
          CASE lServiceHeaderAddress."Address Type" OF
            lServiceHeaderAddress."Address Type"::"Annexe Contact" :
              AddServHeaderAddElement(lContactNode, lServiceHeaderAddress, 'Tiers');
            lServiceHeaderAddress."Address Type"::"Expert Contact" :
              AddServHeaderAddElement(lContactNode, lServiceHeaderAddress, 'Expert');
          END;
        UNTIL lServiceHeaderAddress.NEXT = 0;

      //---------?????????-----------<fus:DateInt‚grationOrdreMission>?</fus:DateInt‚grationOrdreMission>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:DateInt‚grationOrdreMission',
        FUSIONInterfaceMgt.FormatDateTime(lServiceHeader."Creation Date"),FusNameSpace,lNewNode);
      //<fus:DateSinistre>?</fus:DateSinistre>
      lService.GET(lServiceHeader."Service No.");
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:DateSinistre',
          FUSIONInterfaceMgt.FormatDateTime(CREATEDATETIME(lServiceHeader."Event Date", lService."Event Time")),FusNameSpace,lNewNode);
      //<fus:DonneurOrdreCodeGTA>?</fus:DonneurOrdreCodeGTA>
      IF NOT lContact.GET(FUSIONInterfaceMgt.GetServiceSellToContact(lServiceHeader)) THEN
        CLEAR(lContact);
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:DonneurOrdreCodeGTA',
        lContact."GTA Code",FusNameSpace,lNewNode);
      //<fus:FusionDossierId>?</fus:FusionDossierId>
      lGUID := lFusionReference.GetServiceHeaderGUID(lServiceHeader);
      IF lGUID <> '' THEN
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:FusionDossierId', lGUID,FusNameSpace,lNewNode);
      //<fus:IdentifiantServiceSiTiers>?</fus:IdentifiantServiceSiTiers>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:IdentifiantInterventionSiTiers', lServiceHeader."No.",FusNameSpace,lNewNode);
      //-------????????--------cause intervention ?????---------------------<fus:NatureSinistre>?</fus:NatureSinistre>
      //IF NOT lCode.GET(5900, 50104, lServiceHeader."Event Nature") THEN
      //  CLEAR(lCode);
      //FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistre', lCode.Description,FusNameSpace,lNewNode);

      lContactContract.SETRANGE("Contact No.", lService."Contact No.");
      lContactContract.SETRANGE("Corporate No.", lService."Corporate No.");
      lContactContract.SETRANGE("Contract Form Code", lService."Contract Form Code");
      IF lContactContract.FINDFIRST THEN BEGIN
        lContactContract.CALCFIELDS("Contract Name");
        //<fus:Libell‚ContratAssurance>?</fus:Libell‚ContratAssurance>
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Libell‚ContratAssurance', lContactContract."Contract Name",FusNameSpace,lNewNode);
      END;
      //<fus:NAV_CorporateNo>?</fus:NAV_CorporateNo>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NAV_CorporateNo', lServiceHeader."Corporate No.",FusNameSpace,lNewNode);
      //<fus:NAV_InterventionLineNo>?</fus:NAV_InterventionLineNo>
      //<fus:NAV_ServiceHeaderNo>?</fus:NAV_ServiceHeaderNo>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NAV_ServiceHeaderNo', lServiceHeader."No.",FusNameSpace,lNewNode);


      lEAIPartnerCrossReference.SETRANGE("Partner Code", EAISentMQBuffer."EAI Partner Code");
      lEAIPartnerCrossReference.SETRANGE("Table ID", DATABASE::"Fault Reason Code");
      lEAIPartnerCrossReference.SETRANGE("Source No.", lServiceHeader."Service Cause");
      IF lEAIPartnerCrossReference.FINDFIRST THEN BEGIN
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistre',
          lEAIPartnerCrossReference."Partner Reference",FusNameSpace,lNewNode);
        //<fus:NatureSinistreCode>?</fus:NatureSinistreCode>
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistreCode',
          lEAIPartnerCrossReference."Partner Reference",FusNameSpace,lNewNode);
      END ELSE BEGIN
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistre',
          lInterfaceSetup."Fusion Default Service Cause",FusNameSpace,lNewNode);
        //<fus:NatureSinistreCode>?</fus:NatureSinistreCode>
        FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistreCode',
          lInterfaceSetup."Fusion Default Service Cause",FusNameSpace,lNewNode);
      END;

      //lServiceHeader.CALCFIELDS("Service Cause Description");
      //FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:NatureSinistre',
      //  lServiceHeader."Service Cause Description",FusNameSpace,lNewNode);

      //-------????????-----------------------------<fus:Num‚roOM>?</fus:Num‚roOM>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Num‚roOM', '',FusNameSpace,lNewNode);
      //<fus:Num‚roSinistre>?</fus:Num‚roSinistre>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Num‚roSinistre', lServiceHeader."Reference No.",FusNameSpace,lNewNode);

      //Liste documents joints<fus:PiŠcesJointes>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:PiŠcesJointes', '',FusNameSpace,lAttachListNode);
      AddAttachmentsElement(lAttachListNode, lServiceHeader);

      //----------????????????TODO------------<fus:StatutService>?</fus:StatutService>
      //FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:StatutService',
      //    FORMAT(lServiceHeader.Status),FusNameSpace,lNewNode);
      //FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:StatutService',
      //    '',FusNameSpace,lNewNode);

      //Liste commentaire <fus:Suivi>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:Suivi', '',FusNameSpace,lCommentListNode);
      AddCommentsElement(lCommentListNode, lServiceHeader);

      //<fus:TypeService>?</fus:TypeService>
      IF NOT lServiceOrderType.GET(lServiceHeader."Service Order Type") THEN
        CLEAR(lServiceOrderType);
      //FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:TypeService', lServiceOrderType."Fusion Code",FusNameSpace,lNewNode);
      //<fus:TypeServiceCode>?</fus:TypeServiceCode>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:TypeServiceCode', lServiceOrderType."Fusion Code",FusNameSpace,lNewNode);
      //<fus:UtilisateurLoginWindows>?</fus:UtilisateurLoginWindows>
      FUSIONInterfaceMgt.AddElement(lServiceNode,'fus:UtilisateurLoginWindows',
          lServiceHeader."Creation User ID",FusNameSpace,lNewNode);

      CREATE(lAdoStream);
      lAdoStream.Open;
      lAdoStream.Charset('UTF-8');

      lXmlDoc.save(lAdoStream);
      lTempFile.CREATETEMPFILE;
      lFileName := lTempFile.NAME + '.xml';
      lAdoStream.SaveToFile(lFileName);
      lAdoStream.Close;
      CLEAR(EAISentMQBuffer."XML Source");
      EAISentMQBuffer."XML Source".CREATEOUTSTREAM(lOutStream);
      lTempFile.OPEN(lFileName);
      lTempFile.CREATEINSTREAM(lInStream);
      COPYSTREAM(lOutStream,lInStream);
      lTempFile.CLOSE;
      ERASE(lFileName);

      //EAISentMQBuffer."XML Source".EXPORT('C:\TMP\testFusion.xml');
      //EAISentMQBuffer."XML Source".EXPORT('Z:\Fob\Fusion\testFusion_Emmision1.xml');
    END;

    LOCAL PROCEDURE AddContactElement@1100281015(VAR pXMLContact@1100281002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";pContact@1100281000 : Record 5050;pContactType@1100281001 : Text[50]);
    VAR
      lSaluiation@1100281003 : Record 5068;
      lXMLNewNode@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lSalutation@1100281005 : Record 5068;
      lProvider@1100281006 : Record 50000;
      lInterfaceReference@1100281007 : Record 50164;
      lGUID@1100281008 : Text[40];
    BEGIN
      //<fus:AdresseBoitePostale>?</fus:AdresseBoitePostale>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseBoitePostale','',FusNameSpace,lXMLNewNode);
      //<fus:AdresseCodePostal>?</fus:AdresseCodePostal>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseCodePostal',pContact."Post Code",FusNameSpace,lXMLNewNode);
      //<fus:AdresseCompl‚ment>?</fus:AdresseCompl‚ment>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseCompl‚ment',
        pContact.Address + ' ' + pContact."Address 2",FusNameSpace,lXMLNewNode);
      //<fus:AdresseLocalit‚>?</fus:AdresseLocalit‚>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseLocalit‚',pContact.City,FusNameSpace,lXMLNewNode);
      //<fus:AdresseNomVoie>?</fus:AdresseNomVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseNomVoie','',FusNameSpace,lXMLNewNode);
      //<fus:AdresseNumVoie>?</fus:AdresseNumVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseNumVoie','',FusNameSpace,lXMLNewNode);
      //<fus:AdresseTypeVoie>?</fus:AdresseTypeVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseTypeVoie','',FusNameSpace,lXMLNewNode);
      //<fus:Civilit‚>?</fus:Civilit‚>
      IF lSaluiation.GET(pContact."Salutation Code") THEN;
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Civilit‚',
         FUSIONInterfaceMgt.GetFusionSalutation(pContact, lSaluiation.Description),FusNameSpace,lXMLNewNode);
      //<fus:Email>?</fus:Email>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Email',pContact."E-Mail",FusNameSpace,lXMLNewNode);
      //--------??????????----------------<fus:FusionActeurId>?</fus:FusionActeurId>
      //<<IMH02
      //IF pContact."GUID Fusion Code" <> '' THEN
      //  FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:FusionActeurId',pContact."GUID Fusion Code",FusNameSpace,lXMLNewNode);
      lGUID := lInterfaceReference.GetContactGUID(pContact);
      IF lGUID <> '' THEN
        FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:FusionActeurId',lGUID,FusNameSpace,lXMLNewNode);
      //>>IMH02

      //<fus:GenreContact>?</fus:GenreContact>
      IF pContact.Type = pContact.Type::Company THEN
        FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:GenreContact','PersonneMorale',FusNameSpace,lXMLNewNode)
      ELSE
        FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:GenreContact','PersonnePhysique',FusNameSpace,lXMLNewNode);

      //<fus:IdentifiantContactSiTiers>?</fus:IdentifiantContactSiTiers>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:IdentifiantContactSiTiers',pContact."No.",FusNameSpace,lXMLNewNode);
      //<fus:NomRaisonSociale>?</fus:NomRaisonSociale>
      IF pContactType = 'Prestataire' THEN BEGIN
        IF lProvider.GET(pContact."No.") THEN
          FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:NomRaisonSociale',lProvider.Name,FusNameSpace,lXMLNewNode)
        ELSE
          FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:NomRaisonSociale',pContact.Name,FusNameSpace,lXMLNewNode);
      END ELSE
        FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:NomRaisonSociale',pContact.Name,FusNameSpace,lXMLNewNode);
      //<fus:Pr‚nom>?</fus:Pr‚nom>
      //FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Pr‚nom',pContact."First Name",FusNameSpace,lXMLNewNode);
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Pr‚nom','',FusNameSpace,lXMLNewNode);
      //<fus:TypeContact>?</fus:TypeContact>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:TypeContact',pContactType,FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚copie>?</fus:T‚l‚copie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚copie',pContact."Fax No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonProfessionnePortable>?</fus:T‚l‚phonProfessionnePortable>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonProfessionnePortable',
          pContact."Mobile Phone No. 2",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonePersonnelFixe>?</fus:T‚l‚phonePersonnelFixe>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonePersonnelFixe',
          pContact."Phone No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonePersonnelPortable>?</fus:T‚l‚phonePersonnelPortable>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonePersonnelPortable',
          pContact."Mobile Phone No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phoneProfessionnelFixe>?</fus:T‚l‚phoneProfessionnelFixe>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phoneProfessionnelFixe',
          pContact."Phone No. 2",FusNameSpace,lXMLNewNode);
    END;

    LOCAL PROCEDURE AddServHeaderAddElement@1100281032(VAR pXMLContact@1100281002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";pServiceHeaderAddress@1100281000 : Record 50068;pContactType@1100281001 : Text[50]);
    VAR
      lXMLNewNode@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lSaluiation@1100281003 : Record 5068;
      lContact@1100281005 : Record 5050;
      lInterfaceReference@1100281007 : Record 50164;
      lGUID@1100281006 : Text[40];
    BEGIN
      //<fus:AdresseBoitePostale>?</fus:AdresseBoitePostale>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseBoitePostale','',FusNameSpace,lXMLNewNode);
      //<fus:AdresseCodePostal>?</fus:AdresseCodePostal>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseCodePostal',pServiceHeaderAddress."Post Code",FusNameSpace,lXMLNewNode);
      //<fus:AdresseCompl‚ment>?</fus:AdresseCompl‚ment>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseCompl‚ment',
        pServiceHeaderAddress.Address + ' ' + pServiceHeaderAddress."Address 2",FusNameSpace,lXMLNewNode);
      //<fus:AdresseLocalit‚>?</fus:AdresseLocalit‚>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseLocalit‚',pServiceHeaderAddress.City,FusNameSpace,lXMLNewNode);

      //<fus:AdresseNomVoie>?</fus:AdresseNomVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseNomVoie',pServiceHeaderAddress."Way Name",FusNameSpace,lXMLNewNode);
      //<fus:AdresseNumVoie>?</fus:AdresseNumVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseNumVoie',FORMAT(pServiceHeaderAddress."Way No."),FusNameSpace,lXMLNewNode);
      //<fus:AdresseTypeVoie>?</fus:AdresseTypeVoie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:AdresseTypeVoie',pServiceHeaderAddress."Way Type",FusNameSpace,lXMLNewNode);

      //<fus:Civilit‚>?</fus:Civilit‚>
      IF lSaluiation.GET(pServiceHeaderAddress."Salutation Code") THEN;
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Civilit‚',
         FUSIONInterfaceMgt.GetFusionSalutation(lContact, lSaluiation.Description),FusNameSpace,lXMLNewNode);
      //<fus:Email>?</fus:Email>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Email','',FusNameSpace,lXMLNewNode);
      //--------??????????----------------<fus:FusionActeurId>?</fus:FusionActeurId>
      //<<IMH02
      //IF pServiceHeaderAddress."GUID Fusion Code" <> '' THEN
      //  FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:FusionActeurId',
      //    pServiceHeaderAddress."GUID Fusion Code",FusNameSpace,lXMLNewNode);
      lGUID := lInterfaceReference.GetServHeaderAddGUID(pServiceHeaderAddress);
      IF lGUID <> '' THEN
        FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:FusionActeurId',lGUID,FusNameSpace,lXMLNewNode);
      //>>IMH02

      //<fus:GenreContact>?</fus:GenreContact>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:GenreContact','Inconnu',FusNameSpace,lXMLNewNode);

      //<fus:IdentifiantContactSiTiers>?</fus:IdentifiantContactSiTiers>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:IdentifiantContactSiTiers',
        pServiceHeaderAddress."Service Header No." + '#' + FORMAT(pServiceHeaderAddress."Address Type",0,'<Number>') + '#' +
        FORMAT(pServiceHeaderAddress."Address No."),
        FusNameSpace,lXMLNewNode);

      //<fus:NomRaisonSociale>?</fus:NomRaisonSociale>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'NomRaisonSociale',pServiceHeaderAddress.Name,FusNameSpace,lXMLNewNode);
      //<fus:Pr‚nom>?</fus:Pr‚nom>
      //FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Pr‚nom',pServiceHeaderAddress."First Name",FusNameSpace,lXMLNewNode);
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:Pr‚nom','',FusNameSpace,lXMLNewNode);
      //<fus:TypeContact>?</fus:TypeContact>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:TypeContact',pContactType,FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚copie>?</fus:T‚l‚copie>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚copie',pServiceHeaderAddress."Fax No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonProfessionnePortable>?</fus:T‚l‚phonProfessionnePortable>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonProfessionnePortable',
          '',FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonePersonnelFixe>?</fus:T‚l‚phonePersonnelFixe>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonePersonnelFixe',
          pServiceHeaderAddress."Phone No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phonePersonnelPortable>?</fus:T‚l‚phonePersonnelPortable>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phonePersonnelPortable',
          pServiceHeaderAddress."Mobile Phone No.",FusNameSpace,lXMLNewNode);
      //<fus:T‚l‚phoneProfessionnelFixe>?</fus:T‚l‚phoneProfessionnelFixe>
      FUSIONInterfaceMgt.AddElement(pXMLContact,'fus:T‚l‚phoneProfessionnelFixe',
          '',FusNameSpace,lXMLNewNode);
    END;

    LOCAL PROCEDURE AddCommentsElement@1100281009(VAR pXMLCommentList@1100281002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";pServiceHeader@1100281003 : Record 5900);
    VAR
      lXMLComment@1100281000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lXMLNewNode@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lAdvCommentLine@1100281001 : Record 50056;
      lAdvCommentLine2@1100281006 : Record 50056;
      lBigText@1100281005 : BigText;
      lFusionReference@1100281007 : Record 50164;
      lGUID@1100281009 : Text[40];
    BEGIN
      //<fus:AdresseBoitePostale>?</fus:AdresseBoitePostale>
      //FUSIONInterfaceMgt.AddElement(pXMLComment,'fus:AdresseBoitePostale',pContact.Address,FusNameSpace,lXMLNewNode);
      lAdvCommentLine.SETFILTER("Source Table ID", '%1|%2|%3',
          DATABASE::Service, DATABASE::"Service Header", DATABASE::"Service Intervention Line");
      lAdvCommentLine.SETRANGE("Source No.", pServiceHeader."Service No.");
      lAdvCommentLine.SETRANGE("Attached To Line No.", 0);
      lAdvCommentLine.SETRANGE("Fusion Sent", FALSE);


      IF lAdvCommentLine.FINDFIRST THEN
        REPEAT
          lFusionReference.SETRANGE("Source Table ID", DATABASE::"Adv. Comment Line");
          lFusionReference.SETRANGE("Source No.", lAdvCommentLine."Source No.");
          lFusionReference.SETRANGE("Source No. 2", lAdvCommentLine."Source No. 2");
          lFusionReference.SETRANGE("Source No. 3", lAdvCommentLine."Source No. 3");
          lFusionReference.SETRANGE("Source No. 4", lAdvCommentLine."Source No. 4");
          lFusionReference.SETRANGE("Source No. 5", lAdvCommentLine."Source No. 5");
          lFusionReference.SETRANGE("Source No. 6", lAdvCommentLine."Line No.");
          lFusionReference.SETRANGE("Source No. 7", lAdvCommentLine."Source Table ID");
          IF NOT lFusionReference.ISEMPTY THEN BEGIN
            FUSIONInterfaceMgt.AddElement(pXMLCommentList,'fus:SuiviIntervention','',FusNameSpace,lXMLComment);

            CLEAR(lBigText);
            lBigText.ADDTEXT(lAdvCommentLine.Comment);
            lAdvCommentLine2.RESET;
            lAdvCommentLine2.SETRANGE("Source Table ID",lAdvCommentLine."Source Table ID");
            lAdvCommentLine2.SETRANGE("Source No.",lAdvCommentLine."Source No.");
            lAdvCommentLine2.SETRANGE("Source No. 2",lAdvCommentLine."Source No. 2");
            lAdvCommentLine2.SETRANGE("Source No. 3",lAdvCommentLine."Source No. 3");
            lAdvCommentLine2.SETRANGE("Source No. 4",lAdvCommentLine."Source No. 4");
            lAdvCommentLine2.SETRANGE("Attached To Line No.", lAdvCommentLine."Line No.");
            IF lAdvCommentLine2.FINDFIRST THEN
              REPEAT
                lBigText.ADDTEXT(lAdvCommentLine2.Comment);
              UNTIL lAdvCommentLine2.NEXT = 0;


            //<fus:ContenuSuivi>?</fus:ContenuSuivi>
            //FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:ContenuSuivi','',FusNameSpace,lXMLNewNode);
            FUSIONInterfaceMgt.AddBigTextElement(lXMLComment,'fus:ContenuSuivi',lBigText,FusNameSpace,lXMLNewNode);
            //<fus:Cr‚ationSuivi>?</fus:Cr‚ationSuivi>
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:Cr‚ationSuivi',
              FUSIONInterfaceMgt.FormatDateTime(lAdvCommentLine."Creation Date"),
        //      FORMAT(lAdvCommentLine."Creation Date",0, '<Year4>-<Month,2>-<Day,2>T<Hours24>:<Minutes,2>:<Seconds,2>.<Second dec>Z'),
              FusNameSpace,lXMLNewNode);
            //<fus:FusionSuiviId>?</fus:FusionSuiviId>
            lGUID := lFusionReference.GetAdvCommentLineGUID(lAdvCommentLine);
            IF lGUID <> '' THEN
            //IF lAdvCommentLine."GUID Fusion Code" <> '' THEN
              FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:FusionSuiviId',lGUID,FusNameSpace,lXMLNewNode);
            //------------?????????------------<fus:FusionTypeSuivi>?</fus:FusionTypeSuivi>
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:FusionTypeSuivi','',FusNameSpace,lXMLNewNode);
            //<fus:IdentifiantSuiviSiTiers>?</fus:IdentifiantSuiviSiTiers>
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:IdentifiantSuiviSiTiers',
                FORMAT(lAdvCommentLine."Source Table ID")+'#'+lAdvCommentLine."Source No."+'#'+
                lAdvCommentLine."Source No. 2" + '#' + FORMAT(lAdvCommentLine."Source No. 3") + '#' +
                lAdvCommentLine."Source No. 4" + FORMAT(lAdvCommentLine."Line No."),
                FusNameSpace,lXMLNewNode);

            //FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:Libell‚Suivi',lAdvCommentLine.Comment,FusNameSpace,lXMLNewNode);
            //FUSIONInterfaceMgt.AddBigTextElement(lXMLComment,'fus:Libell‚Suivi',lBigText,FusNameSpace,lXMLNewNode);
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:Libell‚Suivi','Suivi NAVISION',FusNameSpace,lXMLNewNode);

            //<fus:NomUtilisateur>?</fus:NomUtilisateur>
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:NomUtilisateur','',FusNameSpace,lXMLNewNode);
            //<fus:UtilisateurLoginWindows>?</fus:UtilisateurLoginWindows>
            FUSIONInterfaceMgt.AddElement(lXMLComment,'fus:UtilisateurLoginWindows',
                lAdvCommentLine."Creation User ID",FusNameSpace,lXMLNewNode);
          END;
        UNTIL lAdvCommentLine.NEXT = 0;
    END;

    LOCAL PROCEDURE AddAttachmentsElement@1100281001(VAR pXMLAttachList@1100281002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";pServiceHeader@1100281003 : Record 5900);
    VAR
      lXMLAttachment@1100281000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lXMLNewNode@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lDocAttachment@1100281001 : Record 50021;
      lAttachTreeviewMgt@1100281005 : Codeunit 50001;
      lAttachmentMgt@1100281006 : Codeunit 50002;
      lFusionReference@1100281008 : Record 50164;
      lGUID@1100281007 : Text[40];
    BEGIN
      {
         <fus:PiŠceJointe>
            <fus:DateCr‚ation>?</fus:DateCr‚ation>
            <fus:FusionPiŠceJointeId>?</fus:FusionPiŠceJointeId>
            <fus:IdentifiantPiŠceJointeSiTiers>?</fus:IdentifiantPiŠceJointeSiTiers>
            <fus:Libell‚>?</fus:Libell‚>
            <fus:NAV_InterventionLineNo>?</fus:NAV_InterventionLineNo>
            <fus:NAV_LineNo>?</fus:NAV_LineNo>
            <fus:NAV_ServiceHeaderNo>?</fus:NAV_ServiceHeaderNo>
            <fus:NAV_ServiceNo>?</fus:NAV_ServiceNo>
            <fus:NomFichier>?</fus:NomFichier>
            <fus:TailleOctet>?</fus:TailleOctet>
            <fus:TypeMime>?</fus:TypeMime>
            <fus:Url>?</fus:Url>
         </fus:PiŠceJointe>
      </fus:PiŠcesJointes>
      }

      lDocAttachment.SETCURRENTKEY("Service No.","Service Document No.","Service Intervention Line No.","Intervention Quote Line No.");
      lDocAttachment.SETRANGE("Service No.", pServiceHeader."Service No.");
      lDocAttachment.SETRANGE(Deleted, FALSE);

      IF lDocAttachment.FINDFIRST THEN
        REPEAT
          FUSIONInterfaceMgt.AddElement(pXMLAttachList,'fus:PiŠceJointe','',FusNameSpace,lXMLAttachment);
          //<fus:DateCr‚ation>?</fus:DateCr‚ation>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:DateCr‚ation',
            FUSIONInterfaceMgt.FormatDateTime(lDocAttachment."Creation Date"),
            FusNameSpace,lXMLNewNode);
          //<fus:Libell‚>?</fus:Libell‚>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:Description',lDocAttachment.Description,FusNameSpace,lXMLNewNode);

          //<fus:FusionPiŠceJointeId>?</fus:FusionPiŠceJointeId>
          //<<IMH05
          //IF lDocAttachment."GUID Fusion Code" <> '' THEN
          //  FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:FusionPiŠceJointeId',
          //    lDocAttachment."GUID Fusion Code",FusNameSpace,lXMLNewNode);
          lGUID := lFusionReference.GetDocAttachmentGUID(lDocAttachment);
          IF lGUID <> '' THEN
            FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:FusionPiŠceJointeId',lGUID,FusNameSpace,lXMLNewNode);
          //>>IMH05

          //<fus:IdentifiantPiŠceJointeSiTiers>?</fus:IdentifiantPiŠceJointeSiTiers>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:IdentifiantPiŠceJointeSiTiers',
              FORMAT(lDocAttachment."Referent Table No.")+'#'+FORMAT(lDocAttachment."Key Integer 1")+'#'+
              FORMAT(lDocAttachment."Key Integer 2") + '#' + lDocAttachment."Key Code 1" + '#' +
              lDocAttachment."Key Code 2" + FORMAT(lDocAttachment."Entry No."),
              FusNameSpace,lXMLNewNode);
          //<fus:NAV_InterventionLineNo>?</fus:NAV_InterventionLineNo>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NAV_InterventionLineNo',
            FORMAT(lDocAttachment."Service Intervention Line No."),FusNameSpace,lXMLNewNode);

          //<fus:NAV_LineNo>?</fus:NAV_LineNo>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NAV_LineNo',
            FORMAT(lDocAttachment."Intervention Quote Line No."),FusNameSpace,lXMLNewNode);

          //<fus:NAV_ServiceHeaderNo>?</fus:NAV_ServiceHeaderNo>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NAV_ServiceHeaderNo',
            lDocAttachment."Service Document No.",FusNameSpace,lXMLNewNode);
          //<fus:NAV_ServiceNo>?</fus:NAV_ServiceNo>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NAV_ServiceNo',
            lDocAttachment."Service No.",FusNameSpace,lXMLNewNode);

          //<fus:Libell‚>?</fus:Libell‚>
          //FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:Description',lDocAttachment.Description,FusNameSpace,lXMLNewNode);
          //FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:Description',
          //  lAttachTreeviewMgt.GetFileName(lDocAttachment),FusNameSpace,lXMLNewNode);
          //<fus:NomFichier>?</fus:NomFichier>

          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NomFichier',
            lAttachTreeviewMgt.GetFileName(lDocAttachment),FusNameSpace,lXMLNewNode);


      //    FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:NomFichier',
      //      '',FusNameSpace,lXMLNewNode);
          //<fus:TailleOctet>?</fus:TailleOctet>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:TailleOctet',
              FORMAT(lAttachmentMgt.GetAttachFileSize(lDocAttachment),0,'<Sign><Integer><Decimals>'),FusNameSpace,lXMLNewNode);
          //<fus:TypeMime>?</fus:TypeMime>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:TypeMime',lDocAttachment.GetMIMEType,FusNameSpace,lXMLNewNode);
          //<fus:Url>?</fus:Url>
          FUSIONInterfaceMgt.AddElement(lXMLAttachment,'fus:Url',lDocAttachment.GetUrl,FusNameSpace,lXMLNewNode);
        UNTIL lDocAttachment.NEXT = 0;
    END;

    LOCAL PROCEDURE AddIntervDescripElement@1100281002(VAR pXMLIntervDescList@1100281002 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";pServiceHeader@1100281003 : Record 5900);
    VAR
      lXMLIntervDesc@1100281000 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lXMLIntervDescLine@1100281007 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lXMLNewNode@1100281004 : Automation "{F5078F18-C551-11D3-89B9-0000F81FE221} 6.0:{2933BF80-7B36-11D2-B20E-00C04F983E60}:'Microsoft XML, v6.0'.IXMLDOMNode";
      lInterventionDescription@1100281001 : Record 50070;
      lIntervDescriptionDetail@1100281006 : Record 50161;
      lBigText@1100281005 : BigText;
    BEGIN
      {
      <fus:rapportExpertise>
         <fus:DateValidationChiffrage>?</fus:DateValidationChiffrage>
         <fus:DossierChiffrageId>?</fus:DossierChiffrageId>
         <fus:D‚tail>
            <fus:RapportExpertiseLigne>
               <fus:CoutUnitaireHT>?</fus:CoutUnitaireHT>
               <fus:DescriptionEl‚mentChiffrage>?</fus:DescriptionEl‚mentChiffrage>
               <fus:DossierChiffrageLigneId>?</fus:DossierChiffrageLigneId>
               <fus:ElementChiffrage_Code>?</fus:ElementChiffrage_Code>
               <fus:El‚mentChiffrage_CodeNavCorpsM‚tier>?</fus:El‚mentChiffrage_CodeNavCorpsM‚tier>
               <fus:El‚mentChiffrage_CodeNavSp‚cialit‚>?</fus:El‚mentChiffrage_CodeNavSp‚cialit‚>
               <fus:El‚mentChiffrage_Description>?</fus:El‚mentChiffrage_Description>
               <fus:El‚mentChiffrage_Libell‚>?</fus:El‚mentChiffrage_Libell‚>
               <fus:FamilleEl‚mentChiffrageLibell‚>?</fus:FamilleEl‚mentChiffrageLibell‚>
               <fus:Libell‚LigneChiffrage>?</fus:Libell‚LigneChiffrage>
               <fus:ModeIndemnisation>?</fus:ModeIndemnisation>
               <fus:NatureDommageLibell‚>?</fus:NatureDommageLibell‚>
               <fus:NatureEl‚mentLibell‚>?</fus:NatureEl‚mentLibell‚>
               <fus:PiŠceLibell‚>?</fus:PiŠceLibell‚>
               <fus:Quantit‚>?</fus:Quantit‚>
               <fus:TauxTVA>?</fus:TauxTVA>
               <fus:TauxV‚tust‚Appliqu‚>?</fus:TauxV‚tust‚Appliqu‚>
               <fus:TypeSurface>?</fus:TypeSurface>
               <fus:Unit‚>?</fus:Unit‚>
            </fus:RapportExpertiseLigne>
         </fus:D‚tail>
         <fus:FranchiseAppliqu‚e>?</fus:FranchiseAppliqu‚e>
         <fus:NomExpertAyantValid‚Chiffrage>?</fus:NomExpertAyantValid‚Chiffrage>
      </fus:rapportExpertise>
      }

      lInterventionDescription.SETRANGE("Service Header No.", pServiceHeader."No.");
      //<fus:DateValidationChiffrage>?</fus:DateValidationChiffrage>
      //<fus:DossierChiffrageId>?</fus:DossierChiffrageId>
      //<fus:D‚tail>
      FUSIONInterfaceMgt.AddElement(pXMLIntervDescList,'fus:D‚tail','',FusNameSpace,lXMLIntervDesc);

      IF lInterventionDescription.FINDFIRST THEN
        REPEAT
          lIntervDescriptionDetail.SETRANGE("Service Header No.", lInterventionDescription."Service Header No.");
          lIntervDescriptionDetail.SETRANGE("Affected Location Code", lInterventionDescription."Affected Location Code");
          lIntervDescriptionDetail.SETRANGE("Speciality Code", lInterventionDescription."Speciality Code");
          lIntervDescriptionDetail.SETRANGE("Building Trade No.", lInterventionDescription."Building Trade No.");
          IF lIntervDescriptionDetail.FINDSET THEN BEGIN
            REPEAT
              //<fus:RapportExpertiseLigne>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDesc,'fus:RapportExpertiseLigne','',FusNameSpace,lXMLIntervDescLine);
              //<fus:CoutUnitaireHT>?</fus:CoutUnitaireHT>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:CoutUnitaireHT',
                FORMAT(lIntervDescriptionDetail."Unit Price"),FusNameSpace,lXMLNewNode);
              //<fus:ModeIndemnisation>?</fus:ModeIndemnisation>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:ModeIndemnisation',
                lIntervDescriptionDetail."Fusion Indemnity Mode",FusNameSpace,lXMLNewNode);
              //<fus:PiŠceLibell‚>?</fus:PiŠceLibell‚>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:PiŠceLibell‚',
                lIntervDescriptionDetail."Affected Location Description",FusNameSpace,lXMLNewNode);
              //<fus:Quantit‚>?</fus:Quantit‚>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:Quantit‚',
                FORMAT(lIntervDescriptionDetail.Quantity),FusNameSpace,lXMLNewNode);

              //<fus:TauxTVA>?</fus:TauxTVA>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:TauxTVA',
                FORMAT(lIntervDescriptionDetail."VAT %"),FusNameSpace,lXMLNewNode);
              //<fus:TauxV‚tust‚Appliqu‚>?</fus:TauxV‚tust‚Appliqu‚>
              //<fus:TypeSurface>?</fus:TypeSurface>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:TypeSurface',
                lIntervDescriptionDetail."Fusion Surface Type",FusNameSpace,lXMLNewNode);
              //<fus:Unit‚>?</fus:Unit‚>
              FUSIONInterfaceMgt.AddElement(lXMLIntervDesc,'fus:Unit‚',
                lIntervDescriptionDetail."Unit of Measure",FusNameSpace,lXMLNewNode);
            UNTIL lIntervDescriptionDetail.NEXT = 0;
          END ELSE BEGIN
            //<fus:RapportExpertiseLigne>
            FUSIONInterfaceMgt.AddElement(lXMLIntervDesc,'fus:RapportExpertiseLigne','',FusNameSpace,lXMLIntervDescLine);
            //<fus:CoutUnitaireHT>?</fus:CoutUnitaireHT>
            FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:CoutUnitaireHT',
              FORMAT(lInterventionDescription."Unit Price"),FusNameSpace,lXMLNewNode);
            //<fus:PiŠceLibell‚>?</fus:PiŠceLibell‚>
            FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:PiŠceLibell‚',
              lInterventionDescription."Affected Location Description",FusNameSpace,lXMLNewNode);
            //<fus:Quantit‚>?</fus:Quantit‚>
            FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:Quantit‚',
              FORMAT(lInterventionDescription.Quantity),FusNameSpace,lXMLNewNode);

            //<fus:TauxTVA>?</fus:TauxTVA>
            FUSIONInterfaceMgt.AddElement(lXMLIntervDescLine,'fus:TauxTVA',
              FORMAT(lInterventionDescription."VAT %"),FusNameSpace,lXMLNewNode);
            //<fus:TauxV‚tust‚Appliqu‚>?</fus:TauxV‚tust‚Appliqu‚>
          END;
        UNTIL lInterventionDescription.NEXT = 0;
    END;

    BEGIN
    {
      /** @r IMH02 @d 12/12/11 @a ISAT.ZW @v IMH6.01.136 @s Interface Fusion @c gestion table reference fusion Contact */
      /** @r IMH01 @d 12/04/11 @a ISAT.ZW @v IMH6.01.136 @s Interface Fusion @c cr‚ation */
    }
    END.
  }
}