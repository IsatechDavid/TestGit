OBJECT Report 8016606 Vendor - Detaill Bal. Open
{
  OBJECT-PROPERTIES
  {
    Date=07/07/09;
    Time=11:24:47;
    Version List=ISA6.00,SUPP;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Vendor-Detail Trial Bal open;
               FRA=Fourn. ‚critures ouvertes];
    TopMargin=1000;
    BottomMargin=500;
    LeftMargin=500;
    OnPreReport=BEGIN
                  VendFilter := Vendor.GETFILTER("No.");
                  FiltreDate := Vendor.GETFILTER("Date Filter");
                  EndDate := Vendor.GETRANGEMAX("Date Filter");
                END;

  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table23;
        DataItemTableView=SORTING(No.);
        PrintOnlyIfDetail=Yes;
        OnPreDataItem=BEGIN
                        CurrReport.NEWPAGEPERRECORD := PrintOnlyOnePerPage;
                        CurrReport.CREATETOTALS("Vendor Ledger Entry"."Amount (LCY)",
                                                "Vendor Ledger Entry"."Debit Amount (LCY)",
                                                "Vendor Ledger Entry"."Credit Amount (LCY)",
                                                StartBalanceLCY);
                        "deja fait":=FALSE;

                        IF ExportExcel THEN BEGIN
                          ExcelLineNo := 1;
                          CreateExcelBuffer;
                          InsertRow(ExcelLineNo,1,Text0001,'');
                          InsertRow(ExcelLineNo,2,Text0002,'');
                          InsertRow(ExcelLineNo,3,Text001,'');
                          InsertRow(ExcelLineNo,4,Text002,'');
                          InsertRow(ExcelLineNo,5,Text003,'');
                          InsertRow(ExcelLineNo,6,Text004,'');
                          InsertRow(ExcelLineNo,7,Text005,'');
                          InsertRow(ExcelLineNo,8,Text012,'');
                          InsertRow(ExcelLineNo,9,Text006,'');
                          InsertRow(ExcelLineNo,10,Text007,'');
                          InsertRow(ExcelLineNo,11,Text008,'');
                          InsertRow(ExcelLineNo,12,Text009,'');
                          InsertRow(ExcelLineNo,13,Text010,'');
                        END;
                      END;

        OnAfterGetRecord=VAR
                           LocDetLedgEntry@1100281000 : Record 380;
                           LocLedgEntry@1100281001 : Record 25;
                         BEGIN
                           StartBalanceLCY := 0;
                           VendBalanceLCY := StartBalanceLCY;
                         END;

        OnPostDataItem=BEGIN
                         IF ExportExcel THEN BEGIN
                           ViewExcel('ExportExcel');
                         END;
                       END;

        ReqFilterFields=No.,Search Name,Vendor Posting Group,Date Filter;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19800;
            SectionHeight=1692;
          }
          CONTROLS
          {
            { 2   ;TextBox      ;16500;0    ;3150 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 3   ;TextBox      ;150  ;423  ;7500 ;423  ;SourceExpr=STRSUBSTNO(Text000,FiltreDate) }
            { 4   ;Label        ;18300;423  ;750  ;423  ;ParentControl=5 }
            { 5   ;TextBox      ;19050;423  ;600  ;423  ;CaptionML=[ENU=Page;
                                                                    FRA=Page];
                                                         SourceExpr=CurrReport.PAGENO }
            { 6   ;TextBox      ;150  ;846  ;7500 ;423  ;SourceExpr=COMPANYNAME }
            { 7   ;TextBox      ;17400;846  ;2250 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 1000000022;Label  ;150  ;0    ;7500 ;423  ;HorzAlign=Left;
                                                         FontSize=12;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Vendor Detail Trial Balance;
                                                                    FRA=Grand livre fournisseurs] }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT( PrintAllHavingBal);
                         END;

          }
          CONTROLS
          {
            { 9   ;Label        ;150  ;0    ;12000;423  ;CaptionML=[ENU=This report also includes vendors that only have balances.;
                                                                    FRA=Cet ‚tat liste les ‚critures ouvertes … la date de fin de p‚riode.] }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(VendFilter <> '');
                         END;

          }
          CONTROLS
          {
            { 10  ;TextBox      ;150  ;0    ;18150;423  ;SourceExpr=Vendor.TABLECAPTION + ': ' + VendFilter }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=19800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(FiltreGestion <> '');
                         END;

          }
          CONTROLS
          {
            { 1000000098;TextBox;150  ;0    ;18150;423  ;SourceExpr=Vendor.FIELDCAPTION("Responsibility Center") + ': ' + FiltreGestion }
          }
           }
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=19800;
            SectionHeight=1299;
          }
          CONTROLS
          {
            { 1000000019;Label  ;7350 ;423  ;1350 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Nø doc. externe }
            { 1000000046;Shape  ;150  ;423  ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000103;Label  ;300  ;423  ;1200 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Posting Date;
                                                                    FRA=Date compta.] }
            { 1000000104;Shape  ;0    ;423  ;300  ;876  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000105;Shape  ;1350 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000106;Label  ;1650 ;423  ;1200 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Due Date;
                                                                    FRA=Date ‚ch‚ance] }
            { 1000000107;Shape  ;2700 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000108;Label  ;3000 ;423  ;1050 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Source Code;
                                                                    FRA=Code journal] }
            { 1000000109;Shape  ;4050 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000110;Label  ;4350 ;423  ;1050 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Type doc. }
            { 1000000111;Shape  ;5400 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000112;Label  ;5700 ;423  ;1500 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Document No.;
                                                                    FRA=Nø document] }
            { 1000000113;Shape  ;8550 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000114;Label  ;8850 ;423  ;3150 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=D‚signation }
            { 1000000115;Shape  ;12000;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000116;Label  ;12300;423  ;1650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Debit;
                                                                    FRA=D‚bit] }
            { 1000000117;Shape  ;13950;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000118;Label  ;14250;423  ;1650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Credit;
                                                                    FRA=Cr‚dit] }
            { 1000000119;Shape  ;15900;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000120;Label  ;16200;423  ;1650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Balance;
                                                                    FRA=Solde] }
            { 1000000121;Shape  ;17850;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000122;Label  ;18150;423  ;1350 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         CaptionML=[ENU=Apply Ref.;
                                                                    FRA=Ref. lettrage] }
            { 1000000123;Shape  ;19500;423  ;300  ;876  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000124;Shape  ;150  ;1269 ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000137;Shape  ;7050 ;423  ;300  ;846  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
        { PROPERTIES
          {
            SectionType=TransHeader;
            SectionWidth=19800;
            SectionHeight=453;
          }
          CONTROLS
          {
            { 1000000080;TextBox;300  ;0    ;2250 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor."No." }
            { 1000000081;TextBox;2700 ;0    ;6300 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor.Name }
            { 1000000096;Shape  ;150  ;423  ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000138;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000139;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000140;Shape  ;19500;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000141;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000142;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000148;Shape  ;0    ;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19800;
            SectionHeight=0;
            OnPreSection=BEGIN
                           IF ExportExcel THEN BEGIN
                             ExcelLineNo += 1;
                             InsertRow(ExcelLineNo,1,Vendor."No.",'');
                             InsertRow(ExcelLineNo,2,Vendor."Search Name",'');
                             InsertRow(ExcelLineNo,8,Text0003,'');
                             InsertRow(ExcelLineNo,11,ConvertNumber(StartBalanceLCY),'');
                           END;
                         END;

          }
          CONTROLS
          {
          }
           }
        { PROPERTIES
          {
            SectionType=TransFooter;
            SectionWidth=19800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           IF NOT(TransfooterLedger) THEN "deja fait":=FALSE;
                         END;

          }
          CONTROLS
          {
            { 1000000073;Shape  ;150  ;0    ;19500;30   ;ShapeStyle=HorzLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=19800;
            SectionHeight=846;
            OnPreSection=BEGIN
                           IF ExportExcel THEN BEGIN
                             ExcelLineNo += 2;
                             InsertRowWithBold(ExcelLineNo,8,Text011,'');
                             InsertRow(ExcelLineNo,11,ConvertNumber(StartBalanceLCY),'');
                             ExcelLineNo += 1;
                             InsertRowWithBold(ExcelLineNo,8,'Total','');
                             InsertRow(ExcelLineNo,9,ConvertNumber("Vendor Ledger Entry"."Debit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,10,ConvertNumber("Vendor Ledger Entry"."Credit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,11,ConvertNumber(StartBalanceLCY + "Vendor Ledger Entry"."Amount (LCY)"),'');
                           END;
                         END;

          }
          CONTROLS
          {
            { 30  ;Label        ;1400 ;423  ;3600 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Total (LCY);
                                                                    FRA=Total DS] }
            { 31  ;TextBox      ;11700;423  ;2100 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr="Vendor Ledger Entry"."Debit Amount (LCY)";
                                                         AutoFormatType=1 }
            { 32  ;TextBox      ;16050;423  ;1950 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=StartBalanceLCY + "Vendor Ledger Entry"."Amount (LCY)";
                                                         AutoFormatType=1 }
            { 26  ;Label        ;1400 ;0    ;3600 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Total (LCY) Before Period;
                                                                    FRA=Total DS avant p‚riode] }
            { 1000000077;TextBox;13950;423  ;1950 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr="Vendor Ledger Entry"."Credit Amount (LCY)";
                                                         AutoFormatType=1 }
            { 29  ;TextBox      ;16050;0    ;1950 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=StartBalanceLCY;
                                                         AutoFormatType=1 }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table25;
        DataItemTableView=SORTING(Vendor No.,Posting Date);
        OnPreDataItem=BEGIN
                        VendLedgEntryExists := FALSE;
                        CurrReport.CREATETOTALS("Debit Amount (LCY)","Credit Amount (LCY)","Amount (LCY)");
                      END;

        OnAfterGetRecord=VAR
                           i@1100281000 : Integer;
                         BEGIN
                           SETFILTER("Date Filter",'%1..%2',0D ,EndDate);
                           CALCFIELDS("Debit Amount (LCY)","Credit Amount (LCY)","Amount (LCY)");

                           IF ("Debit Amount (LCY)"=0) AND ("Credit Amount (LCY)"=0) THEN CurrReport.SKIP;

                             //=======Test si ecriture ouverte a date de fin de periode
                             VendorLedgerEntryGlobal := "Vendor Ledger Entry";

                             VendorLedgerEntryCumul.RESET;
                             VendorLedgerEntryCumul.INIT;
                             VendorLedgerEntryCumul.SETCURRENTKEY("Vendor No.","Posting Date");
                             VendorLedgerEntryCumul.SETRANGE("Vendor No.","Vendor No.");
                             VendorLedgerEntryCumul.SETFILTER("Date Filter",'%1..%2',0D,EndDate);
                             IF NOT Existe("Entry No.") THEN BEGIN  //si l'ecriture courante appartient deja au filtre precedent
                               FOR i:=1 TO 10 DO BEGIN              //on ne refait pas la recherche les lien de lettrage.
                                 FilterEntry[i]:='0';
                               END;
                               SetFilterLedger("Entry No.");
                             END;

                             TotalLettre := 0;
                             FOR i := 1 TO 10 DO BEGIN
                               IF STRLEN(FilterEntry[i]) > 1 THEN BEGIN
                                 VendorLedgerEntryCumul.SETFILTER("Entry No.",FilterEntry[i]);
                                 IF VendorLedgerEntryCumul.FIND('-') THEN
                                   REPEAT
                                     VendorLedgerEntryCumul.CALCFIELDS(VendorLedgerEntryCumul."Amount (LCY)");
                                     TotalLettre := TotalLettre + VendorLedgerEntryCumul."Amount (LCY)";
                                   UNTIL VendorLedgerEntryCumul.NEXT = 0;

                               END;
                             END;

                             IF TotalLettre =  0 THEN
                               CurrReport.SKIP;

                             //=======================================================


                           VendLedgEntryExists := TRUE;
                           VendCurrencyCode := '';
                           VendBalanceLCY := VendBalanceLCY + "Amount (LCY)";
                         END;

        DataItemLink=Vendor No.=FIELD(No.),
                     Global Dimension 1 Code=FIELD(Global Dimension 1 Filter),
                     Global Dimension 2 Code=FIELD(Global Dimension 2 Filter);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            SectionWidth=19800;
            SectionHeight=453;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT(NOT "deja fait");
                           "deja fait":=TRUE;
                         END;

          }
          CONTROLS
          {
            { 1100281024;TextBox;300  ;0    ;2250 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor."No." }
            { 1100281025;TextBox;2700 ;0    ;6300 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor.Name }
            { 1100281026;Shape  ;150  ;423  ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1100281027;Shape  ;19500;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281028;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281029;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281030;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281031;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281032;Shape  ;0    ;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
        { PROPERTIES
          {
            SectionType=TransHeader;
            SectionWidth=19800;
            SectionHeight=453;
          }
          CONTROLS
          {
            { 33  ;Label        ;9150 ;0    ;2850 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Continued;
                                                                    FRA=Report] }
            { 51  ;TextBox      ;16200;0    ;1650 ;423  ;HorzAlign=Right;
                                                         FontBold=Yes;
                                                         SourceExpr=StartBalanceLCY + "Amount (LCY)";
                                                         AutoFormatType=1 }
            { 1000000078;TextBox;300  ;0    ;2250 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor."No." }
            { 1000000079;TextBox;2700 ;0    ;6300 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Vendor.Name }
            { 1000000045;Shape  ;150  ;423  ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000174;Shape  ;19500;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000175;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000176;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000177;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000178;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000185;Shape  ;0    ;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19800;
            SectionHeight=0;
            OnPreSection=VAR
                           locDetVendLedgEntry@1000000000 : Record 380;
                         BEGIN
                           TransfooterLedger:=FALSE;

                           Indication := '';
                           RefApply := '';
                           IF ShowRefApply THEN BEGIN
                             locDetVendLedgEntry.RESET;
                             locDetVendLedgEntry.SETRANGE("Vendor Ledger Entry No.","Entry No.");
                             locDetVendLedgEntry.SETRANGE("Entry Type",locDetVendLedgEntry."Entry Type"::Application);
                             IF locDetVendLedgEntry.FIND('+') THEN BEGIN
                               IF locDetVendLedgEntry."Posting Date" > Vendor.GETRANGEMAX("Date Filter") THEN BEGIN
                                 Indication := '*';
                               END;
                               RefApply := locDetVendLedgEntry."Document No.";
                             END;
                           END;

                           IF ExportExcel THEN BEGIN
                             ExcelLineNo += 1;
                             InsertRow(ExcelLineNo,1,Vendor."No.",'');
                             InsertRow(ExcelLineNo,2,Vendor."Search Name",'');
                             //<<ISA.02 innexa.sc
                             InsertRow(ExcelLineNo,3,FORMAT("Posting Date"),'');
                             //>>ISA.02 innexa.sc
                             InsertRow(ExcelLineNo,4,FORMAT("Due Date"),'');
                             InsertRow(ExcelLineNo,5,"Source Code",'');
                             InsertRow(ExcelLineNo,6,FORMAT("Document Type"),'');
                             InsertRow(ExcelLineNo,7,"Document No.",'');
                             InsertRow(ExcelLineNo,8,"External Document No.",'');
                             InsertRow(ExcelLineNo,9,Description,'');
                             InsertRow(ExcelLineNo,10,ConvertNumber("Debit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,11,ConvertNumber("Credit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,12,ConvertNumber(VendBalanceLCY),'');
                             InsertRow(ExcelLineNo,13,RefApply,'');
                             InsertRow(ExcelLineNo,14,Indication,'');
                           END;
                           CurrReport.SHOWOUTPUT(FALSE);
                         END;

          }
          CONTROLS
          {
          }
           }
        { PROPERTIES
          {
            SectionType=TransFooter;
            SectionWidth=19800;
            SectionHeight=423;
            OnPreSection=BEGIN
                           TransfooterLedger:=TRUE;
                         END;

          }
          CONTROLS
          {
            { 46  ;Label        ;8850 ;0    ;3150 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         LeaderDots=Yes;
                                                         CaptionML=[ENU=Continued;
                                                                    FRA=Report] }
            { 53  ;TextBox      ;16200;0    ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=StartBalanceLCY + "Amount (LCY)";
                                                         AutoFormatType=1 }
            { 1000000198;Shape  ;19500;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000199;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000200;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000201;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000202;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000203;Shape  ;8550 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000204;Shape  ;7050 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000205;Shape  ;5400 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000206;Shape  ;4050 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000207;Shape  ;2700 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000208;Shape  ;1350 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000209;Shape  ;0    ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=2;
        DataItemTable=Table380;
        DataItemTableView=SORTING(Vendor Ledger Entry No.,Posting Date)
                          WHERE(Entry Type=FILTER(<>Application));
        OnPreDataItem=BEGIN
                        SETFILTER("Posting Date",'%1..%2',0D ,EndDate);
                      END;

        DataItemLink=Vendor Ledger Entry No.=FIELD(Entry No.);
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19800;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 1100281000;TextBox;300  ;0    ;1050 ;423  ;HorzAlign=Left;
                                                         SourceExpr="Posting Date" }
            { 1100281001;TextBox;4350 ;0    ;1050 ;423  ;HorzAlign=Left;
                                                         CaptionML=[ENU=Document Type;
                                                                    FRA=Type document];
                                                         SourceExpr="Document Type" }
            { 1100281002;TextBox;5650 ;0    ;1500 ;423  ;HorzAlign=Left;
                                                         FontSize=6;
                                                         SourceExpr="Document No." }
            { 1100281003;TextBox;8850 ;0    ;3150 ;423  ;HorzAlign=Left;
                                                         SourceExpr="Vendor Ledger Entry".Description }
            { 1100281004;TextBox;12300;0    ;1650 ;423  ;HorzAlign=Right;
                                                         SourceExpr="Debit Amount (LCY)";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=VendCurrencyCode }
            { 1100281005;TextBox;16200;0    ;1650 ;423  ;HorzAlign=Right;
                                                         CaptionML=[ENU=Balance (LCY);
                                                                    FRA=Solde DS];
                                                         SourceExpr=VendBalanceLCY;
                                                         AutoFormatType=1 }
            { 1100281006;TextBox;14250;0    ;1650 ;423  ;HorzAlign=Right;
                                                         SourceExpr="Credit Amount (LCY)";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=VendCurrencyCode }
            { 1100281007;TextBox;3000 ;0    ;1075 ;423  ;HorzAlign=Left;
                                                         SourceExpr="Source Code" }
            { 1100281008;TextBox;7300 ;0    ;1350 ;423  ;HorzAlign=Left;
                                                         FontSize=6;
                                                         SourceExpr="Vendor Ledger Entry"."External Document No." }
            { 1100281009;TextBox;1650 ;0    ;1050 ;423  ;HorzAlign=Left;
                                                         SourceExpr="Vendor Ledger Entry"."Due Date" }
            { 1100281010;Shape  ;19500;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281011;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281012;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281013;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281014;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281015;Shape  ;8550 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281016;Shape  ;7050 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281017;Shape  ;5400 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281018;Shape  ;4050 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281019;Shape  ;2700 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281020;Shape  ;1350 ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281021;Shape  ;0    ;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1100281022;TextBox;18150;0    ;1350 ;423  ;HorzAlign=Right;
                                                         FontSize=6;
                                                         SourceExpr=RefApply;
                                                         AutoFormatType=1 }
            { 1100281023;TextBox;18000;0    ;300  ;423  ;HorzAlign=Right;
                                                         SourceExpr=Indication;
                                                         AutoFormatType=1 }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemIndent=1;
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=CONST(1));
        OnAfterGetRecord=BEGIN
                           "deja fait" := FALSE;
                           IF NOT VendLedgEntryExists AND ((StartBalanceLCY = 0) OR NOT PrintAllHavingBal) THEN BEGIN
                             StartBalanceLCY := 0;
                           //  CurrReport.SKIP;
                           END;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=19800;
            SectionHeight=453;
            OnPreSection=BEGIN
                           CurrReport.SHOWOUTPUT( StartBalanceLCY + "Vendor Ledger Entry"."Amount (LCY)"<>0);

                           IF ExportExcel AND NOT (PrintAllHavingBal AND (StartBalanceLCY <> 0)) THEN BEGIN
                             ExcelLineNo += 1;
                             InsertRowWithBold(ExcelLineNo,8,'Total ' + Vendor."Search Name",'');
                             InsertRow(ExcelLineNo,9,ConvertNumber("Vendor Ledger Entry"."Debit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,10,ConvertNumber("Vendor Ledger Entry"."Credit Amount (LCY)"),'');
                             InsertRow(ExcelLineNo,11,ConvertNumber(StartBalanceLCY + "Vendor Ledger Entry"."Amount (LCY)"),'');
                           END;
                         END;

          }
          CONTROLS
          {
            { 48  ;TextBox      ;2550 ;0    ;7650 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr='Total '+Vendor.Name }
            { 49  ;TextBox      ;12300;0    ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr="Vendor Ledger Entry"."Debit Amount (LCY)";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=VendCurrencyCode }
            { 56  ;TextBox      ;16200;0    ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=StartBalanceLCY + "Vendor Ledger Entry"."Amount (LCY)";
                                                         AutoFormatType=1 }
            { 1000000074;Shape  ;150  ;0    ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000075;Shape  ;150  ;423  ;19500;30   ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000076;TextBox;14250;0    ;1650 ;423  ;HorzAlign=Right;
                                                         FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr="Vendor Ledger Entry"."Credit Amount (LCY)";
                                                         AutoFormatType=1;
                                                         AutoFormatExpr=VendCurrencyCode }
            { 1000000210;Shape  ;19500;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000211;Shape  ;17850;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000212;Shape  ;15900;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000213;Shape  ;13950;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000214;Shape  ;12000;0    ;300  ;423  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
            { 1000000221;Shape  ;0    ;0    ;300  ;453  ;BorderWidth=1pt;
                                                         ShapeStyle=VertLine }
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=4295;
      Height=3300;
      SaveValues=Yes;
      OnOpenForm=BEGIN
                   PrintAllHavingBal:=TRUE; //forcage a yes
                   ToutesEcr:=TRUE;
                 END;

    }
    CONTROLS
    {
      { 2   ;CheckBox     ;3740 ;660  ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=New Page per Vendor;
                                                              FRA=Nouvelle page par fournisseur];
                                                   SourceExpr=PrintOnlyOnePerPage }
      { 22  ;Label        ;0    ;660  ;3630 ;440  ;ParentControl=2 }
      { 3   ;CheckBox     ;3740 ;1650 ;440  ;440  ;Visible=No;
                                                   ShowCaption=No;
                                                   CaptionML=[ENU=Include Vendors That Have A Balance Only;
                                                              FRA=Inclure seulement les fournisseurs ayant un solde ouvert];
                                                   SourceExpr=PrintAllHavingBal }
      { 23  ;Label        ;0    ;1210 ;3630 ;880  ;Visible=No;
                                                   ParentControl=3;
                                                   VertAlign=Bottom;
                                                   MultiLine=Yes }
      { 1000000000;Label  ;0    ;2200 ;3630 ;440  ;Visible=No;
                                                   ParentControl=1000000001 }
      { 1000000001;CheckBox;3740;2200 ;440  ;440  ;Visible=No;
                                                   ShowCaption=No;
                                                   CaptionML=FRA=Toutes les ‚critures;
                                                   SourceExpr=ToutesEcr }
      { 1000000002;CheckBox;3740;2860 ;555  ;440  ;ShowCaption=No;
                                                   SourceExpr=ShowRefApply }
      { 1000000003;Label  ;0    ;2860 ;3630 ;440  ;CaptionML=[ENU=Show Ref. Apply;
                                                              FRA=Afficher r‚f. lettrage] }
      { 1000000004;CheckBox;3740;0    ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=Excel export;
                                                              FRA=Export excel];
                                                   SourceExpr=ExportExcel }
      { 1000000005;Label  ;0    ;0    ;3630 ;440  ;ParentControl=1000000004 }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Period: %1;FRA=P‚riode : %1';
      VendorLedgEntry@1000000002 : Record 25;
      ExcelBuffer@1000000021 : TEMPORARY Record 370;
      EndDate@1000000001 : Date;
      VendCurrencyCode@1000000024 : Code[10];
      RefApply@1000000008 : Text[50];
      Indication@1000000007 : Text[1];
      VendFilter@1001 : Text[250];
      FiltreDate@1002 : Text[30];
      FiltreGestion@1000000005 : Text[30];
      ExportExcel@1000000025 : Boolean;
      "deja fait"@1000000006 : Boolean;
      FirstTime@1000000029 : Boolean;
      TransfooterLedger@1000000004 : Boolean;
      ShowRefApply@1000000003 : Boolean;
      PrintAllHavingBal@1008 : Boolean;
      PrintOnlyOnePerPage@1010 : Boolean;
      VendLedgEntryExists@1011 : Boolean;
      ToutesEcr@1000000000 : Boolean;
      Text001@1000000019 : TextConst 'ENU=Posting Date;FRA=Date de comptabilisation';
      Text0001@1000000028 : TextConst 'ENU=Vendor No.;FRA=Nø fournisseur';
      Text0002@1000000027 : TextConst 'ENU=Vendor Search Name;FRA=Nom recherche fournisseur';
      Text0003@1000000030 : TextConst 'ENU=Starting Balance;FRA=Solde d‚but';
      Text002@1000000018 : TextConst 'ENU=Due Date;FRA=Date d''‚ch‚ance';
      Text003@1000000017 : TextConst 'FRA=Code journal';
      Text004@1000000016 : TextConst 'ENU=Doc. Type;FRA=Type doc.';
      Text005@1000000015 : TextConst 'ENU=Document No.;FRA=Nø document';
      Text006@1000000014 : TextConst 'ENU=Description;FRA=D‚signation';
      Text007@1000000013 : TextConst 'ENU=Debit;FRA=D‚bit';
      Text008@1000000012 : TextConst 'ENU=Credit;FRA=Cr‚dit';
      Text009@1000000011 : TextConst 'ENU=Balance;FRA=Solde';
      Text010@1000000010 : TextConst 'ENU=Apply Ref.;FRA=Ref. lettrage';
      Text011@1000000009 : TextConst 'ENU=Total (LCY) Before Period;FRA=Total avant p‚riode';
      VendBalanceLCY@1000000023 : Decimal;
      StartBalanceLCY@1000000022 : Decimal;
      ExcelLineNo@1000000020 : Integer;
      Text012@1000000026 : TextConst 'ENU=External Document No.;FRA=Nø doc. externe';
      FilterEntry@1100281003 : ARRAY [10] OF Text[1024];
      VendorLedgerEntryCumul@1100281002 : Record 25;
      VendorLedgerEntryGlobal@1100281001 : Record 25;
      TotalLettre@1100281000 : Decimal;

    PROCEDURE ConvertNumber@1000000005(Number@1000000000 : Decimal) : Text[50];
    VAR
      locFormat@1000000001 : Text[50];
      locFromCar@1000000004 : TextConst 'FRA=.';
      locToCar@1000000005 : TextConst 'FRA=,';
    BEGIN
      locFormat := '<Sign><Integer><Decimals>';

      EXIT(FORMAT(Number,0,locFormat));
      //EXIT(CONVERTSTR(FORMAT(Number,0,locFormat),locFromCar,locToCar));
    END;

    PROCEDURE InsertRow@1000000000(RowNo@1000000000 : Integer;ColumnNo@1000000001 : Integer;CellValue@1000000002 : Text[250];NbFormat@1000000003 : Text[30]);
    BEGIN
      ExcelBuffer.INIT;
      ExcelBuffer.VALIDATE("Row No.",RowNo);
      ExcelBuffer.VALIDATE("Column No.",ColumnNo);
      ExcelBuffer."Cell Value as Text" := CellValue;
      ExcelBuffer.NumberFormat := NbFormat;
      ExcelBuffer.Formula := '';
      ExcelBuffer.INSERT;
    END;

    PROCEDURE InsertRowWithBold@1000000001(RowNo@1000000000 : Integer;ColumnNo@1000000001 : Integer;CellValue@1000000002 : Text[250];NbFormat@1000000003 : Text[30]);
    BEGIN
      ExcelBuffer.INIT;
      ExcelBuffer.VALIDATE("Row No.",RowNo);
      ExcelBuffer.VALIDATE("Column No.",ColumnNo);
      ExcelBuffer."Cell Value as Text" := CellValue;
      ExcelBuffer.NumberFormat := NbFormat;
      ExcelBuffer.Bold := TRUE;
      ExcelBuffer.Formula := '';
      ExcelBuffer.INSERT;
    END;

    PROCEDURE ViewExcel@1000000002(Name@1000000000 : Text[30]);
    BEGIN
      ExcelBuffer.CreateBook;
      ExcelBuffer.CreateSheet(Name,Name,'','');
      ExcelBuffer.GiveUserControl;
      CLEAR(ExcelBuffer);
    END;

    PROCEDURE CreateExcelBuffer@1000000004();
    BEGIN
      ExcelBuffer.DELETEALL;
      CLEAR(ExcelBuffer);
    END;

    PROCEDURE SetFilterLedger@1000000006(ByInit@1000000000 : Integer);
    VAR
      Loc_apply2@1000000001 : Record 25;
    BEGIN
      //Cette fonction doit permettre de constituer le filtre qui va bien pour l'ensemble des ‚criture li‚ par un lettrage
      //FilterEntry:=STRSUBSTNO('%1',ByInit);
      IF NOT Existe(ByInit) THEN  BEGIN
        Descendant(ByInit);
        Ascendant(ByInit);
      END;
    END;

    PROCEDURE Descendant@1000000007(ByInit@1000000002 : Integer);
    VAR
      locVendorLedgerEntry@1000000001 : Record 25;
    BEGIN
      Ajout(ByInit);
      locVendorLedgerEntry.GET(ByInit);
      IF locVendorLedgerEntry."Closed by Entry No." <> 0 THEN
        IF NOT Existe(locVendorLedgerEntry."Closed by Entry No.") THEN
          SetFilterLedger(locVendorLedgerEntry."Closed by Entry No.")
        ELSE
          VendorLedgerEntryGlobal := locVendorLedgerEntry;
    END;

    PROCEDURE Ascendant@1000000008(ByInit@1000000000 : Integer);
    VAR
      locVendorLedgerEntry@1000000001 : Record 25;
    BEGIN
      Ajout(ByInit);
      locVendorLedgerEntry.SETCURRENTKEY("Vendor No.","Posting Date");
      locVendorLedgerEntry.SETRANGE("Vendor No.",Vendor."No.");
      locVendorLedgerEntry.SETRANGE("Closed by Entry No.",ByInit);
      IF locVendorLedgerEntry.FIND('-') THEN BEGIN
        REPEAT
          IF locVendorLedgerEntry."Closed by Entry No." = 0 THEN
            VendorLedgerEntryGlobal := locVendorLedgerEntry;
          IF NOT Existe(locVendorLedgerEntry."Entry No.") THEN
            SetFilterLedger(locVendorLedgerEntry."Entry No.");
        UNTIL locVendorLedgerEntry.NEXT=0;
      END;
    END;

    PROCEDURE Existe@1000000009(ByInit@1000000000 : Integer) : Boolean;
    VAR
      locFilter@1000000001 : Text[1000];
      locI@1100281000 : Integer;
    BEGIN
      FOR locI := 1 TO 10 DO BEGIN
        locFilter := FilterEntry[locI] + '|';
        IF STRPOS(locFilter,STRSUBSTNO('|%1|',FORMAT(ByInit)))<>0 THEN
          EXIT(TRUE);
      END;

      EXIT(FALSE);
    END;

    PROCEDURE Ajout@1100281000(ByInit@1100281000 : Integer);
    VAR
      locI@1100281001 : Integer;
    BEGIN
      IF NOT Existe(ByInit) THEN BEGIN
        FOR locI := 1 TO 10 DO BEGIN
          IF STRLEN(FilterEntry[locI]) < 500 THEN BEGIN
            FilterEntry[locI] := STRSUBSTNO('%1|%2',FilterEntry[locI],ByInit);
            EXIT;
          END;
        END;
      END;
    END;

    BEGIN
    {
      /** @r ISA01 @d 07/07/09 @a ISAT.MA @v ISA6.00.00.01 @s Migration v6 **/
    }
    END.
  }
  RDLDATA
  {
  }
}