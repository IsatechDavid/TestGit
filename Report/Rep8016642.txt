OBJECT Report 8016642 FA Depres. Book
{
  OBJECT-PROPERTIES
  {
    Date=16/03/12;
    Time=11:58:26;
    Modified=Yes;
    Version List=ISA6.00,IMISAT6.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Dotations Report;
               FRA=Immo. - Etat des dotations];
    TopMargin=1000;
    BottomMargin=1000;
    LeftMargin=1000;
    RightMargin=1000;
    OnPreReport=BEGIN
                  FirstRec := FALSE;

                  DeprBook.GET(DeprBookCode);
                  Year365Days := DeprBook."Fiscal Year 365 Days"; //ISA01.ST
                  IF GroupTotals = GroupTotals::"FA Posting Group" THEN
                    FAGenReport.SetFAPostingGroup("Fixed Asset",DeprBook.Code);
                  FAGenReport.AppendFAPostingFilter("Fixed Asset",StartingDate,EndingDate);
                  FAFilter := "Fixed Asset".GETFILTERS;
                  DeprBookText := STRSUBSTNO('%1%2 %3',DeprBook.TABLECAPTION,':',DeprBookCode);
                  MakeGroupTotalText;
                  ValidateDates;
                  IF PrintDetails THEN BEGIN
                    FANo := "Fixed Asset".FIELDCAPTION("No.");
                    FADescription := "Fixed Asset".FIELDCAPTION(Description);
                  END;
                  IF DeprBook."No. of Days in Fiscal Year" > 0 THEN
                    DaysInFiscalYear := DeprBook."No. of Days in Fiscal Year"
                  ELSE
                    DaysInFiscalYear := 360;
                  //<<ISA01.ST
                  IF Year365Days THEN
                    DaysInFiscalYear := 365;
                  //>>ISA01.ST

                  IF PeriodLength = 0 THEN
                    PeriodLength := DaysInFiscalYear;
                  IF (PeriodLength <= 5) OR (PeriodLength > DaysInFiscalYear) THEN
                    ERROR(
                      Text000,DaysInFiscalYear);
                  FALedgEntry2."FA Posting Type" := FALedgEntry2."FA Posting Type"::Depreciation;
                  DeprText := STRSUBSTNO('%1',FALedgEntry2."FA Posting Type");
                  IF DeprBook."Use Custom 1 Depreciation" THEN BEGIN
                    DeprText2 := DeprText;
                    FALedgEntry2."FA Posting Type" := FALedgEntry2."FA Posting Type"::"Custom 1";
                    Custom1Text := STRSUBSTNO('%1',FALedgEntry2."FA Posting Type");
                    DeprCustom1Text := STRSUBSTNO('%1 %2 %3',DeprText,'+',Custom1Text);
                  END;
                  SalesPriceFieldname := FADeprBook.FIELDCAPTION("Projected Proceeds on Disposal");
                  GainLossFieldname := Text001;
                END;

    OnPostReport=BEGIN
                   IF CreateXl THEN BEGIN
                      FASetup.GET;
                      IF ((FASetup."R50040.Filemane" <> '') AND (FASetup."R50040.Sheet" <> '')) THEN
                         R370.OpenBook(FASetup."R50040.Filemane",FASetup."R50040.Sheet")
                      ELSE
                         R370.CreateBook;

                      R370.CreateSheet('Etat dotations','Etat des dotations',COMPANYNAME,USERID);
                      R370.DELETEALL;
                      R370B.RESET;
                      IF R370B.FIND('-') THEN
                      BEGIN
                         REPEAT
                            R370.INIT;
                            R370.TRANSFERFIELDS(R370B);
                            R370.INSERT(TRUE);
                         UNTIL(R370B.NEXT = 0);
                         R370.CreateSheet('SynthŠse','SynthŠse (Etat des dotations)',COMPANYNAME,USERID);
                      END;
                      R370.GiveUserControl;
                   END;
                 END;

  }
  DATAITEMS
  {
    { PROPERTIES
      {
        DataItemTable=Table5600;
        DataItemTableView=SORTING(No.);
        NewPagePerGroup=No;
        NewPagePerRecord=No;
        OnPreDataItem=BEGIN
                        CASE GroupTotals OF
                          GroupTotals::"FA Class":
                            SETCURRENTKEY("FA Class Code");
                          GroupTotals::"FA Subclass":
                            SETCURRENTKEY("FA Subclass Code");
                          GroupTotals::"FA Location":
                            SETCURRENTKEY("FA Location Code");
                          GroupTotals::"Main Asset":
                            SETCURRENTKEY("Component of Main Asset");
                          GroupTotals::"Global Dimension 1":
                            SETCURRENTKEY("Global Dimension 1 Code");
                          GroupTotals::"Global Dimension 2":
                            SETCURRENTKEY("Global Dimension 2 Code");
                          GroupTotals::"FA Posting Group":
                            SETCURRENTKEY("FA Posting Group");
                        END;
                        CurrReport.CREATETOTALS(BookValue,DeprAmount[1],DeprAmount[2]);

                        IF (CreateXl) THEN
                        BEGIN
                           XlLine(R370);
                           R370.INIT;
                           R370.VALIDATE("Row No.",VLine);
                           R370.VALIDATE("Column No.",1);
                           R370.Bold := FALSE;
                           R370."Cell Value as Text" := 'Nø immobilisation';
                           R370.INSERT;
                           VLine += 2;

                           R370.INIT;
                           R370.VALIDATE("Row No.",VLine);
                           R370.Bold := TRUE;
                           R370.VALIDATE("Column No.",4);
                           R370."Cell Value as Text" := '.. ' + FORMAT(CALCDATE('-1J',StartingDate));
                           R370.INSERT;
                           R370.VALIDATE("Column No.",6);
                           R370."Cell Value as Text" := FORMAT(StartingDate) + '..' + FORMAT(EndingDate);
                           R370.INSERT;
                           VLine += 1;

                           R370.INIT;
                           R370.VALIDATE("Row No.",VLine);
                           R370.VALIDATE("Column No.",2);
                           R370.Bold := TRUE;
                           R370."Cell Value as Text" := 'Nø immobilisation';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",1);
                           R370."Cell Value as Text" := 'Groupe';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",3);
                           R370."Cell Value as Text" := 'D‚signation';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",4);
                           R370."Cell Value as Text" := 'Valeur d''acquisition ' + FORMAT(EndingDate);
                           R370.INSERT;
                           R370.VALIDATE("Column No.",5);
                           R370."Cell Value as Text" := 'Cumul Amort. avt p‚riode';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",6);
                           R370."Cell Value as Text" := 'VNC d‚but p‚riode';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",7);
                           R370."Cell Value as Text" := 'Amort p‚riode';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",8);
                           R370."Cell Value as Text" := 'Cumul Amort.';
                           R370.INSERT;
                           R370.VALIDATE("Column No.",9);
                           R370."Cell Value as Text" := 'VNC ' + FORMAT(EndingDate);
                           R370.INSERT;
                           VLine += 1;
                        END;
                      END;

        OnAfterGetRecord=BEGIN
                           Cumul := 0;
                           IF NOT FADeprBook.GET("No.",DeprBookCode) THEN
                             CurrReport.SKIP;
                           IF SkipRecord THEN
                             CurrReport.SKIP;

                           IF GroupTotals = GroupTotals::"FA Posting Group" THEN
                             IF "FA Posting Group" <> FADeprBook."FA Posting Group" THEN
                               ERROR(Text004,FIELDCAPTION("FA Posting Group"),"No.");

                           FADeprBook.CALCFIELDS("Acquisition Cost");
                           BookValue := FADeprBook."Acquisition Cost";
                           DeprAmount[1] :=FAGenReport.CalcFAPostedAmount(
                                   "No.",FADeprBook.FIELDNO(Depreciation),0,StartingDate,EndingDate,
                                   DeprBookCode,BeforeAmount,EndingAmount,FALSE,TRUE);
                           DeprAmount[2] :=FAGenReport.CalcFAPostedAmount(
                                   "No.",FADeprBook.FIELDNO(Depreciation),1,StartingDate,EndingDate,
                                   DeprBookCode,BeforeAmount,EndingAmount,FALSE,TRUE);

                           FixedAsset.RESET;
                           FixedAsset.COPYFILTERS("Fixed Asset");

                           CASE GroupTotals OF
                             GroupTotals::"FA Class":
                               FixedAsset.SETCURRENTKEY("FA Class Code");
                             GroupTotals::"FA Subclass":
                               FixedAsset.SETCURRENTKEY("FA Subclass Code");
                             GroupTotals::"FA Location":
                               FixedAsset.SETCURRENTKEY("FA Location Code");
                             GroupTotals::"Main Asset":
                               FixedAsset.SETCURRENTKEY("Component of Main Asset");
                             GroupTotals::"Global Dimension 1":
                               FixedAsset.SETCURRENTKEY("Global Dimension 1 Code");
                             GroupTotals::"Global Dimension 2":
                               FixedAsset.SETCURRENTKEY("Global Dimension 2 Code");
                             GroupTotals::"FA Posting Group":
                               FixedAsset.SETCURRENTKEY("FA Posting Group");
                           END;

                           TransferValues;
                           IF (CreateXl) THEN
                           BEGIN
                              R370.INIT;
                              R370.VALIDATE("Row No.",VLine);
                              R370.VALIDATE("Column No.",1);
                              R370.Bold := FALSE;
                              MakeGroupHeadLine;
                              R370."Cell Value as Text" := GroupHeadLine;
                              R370.INSERT;
                              R370.VALIDATE("Column No.",2);
                              R370.Bold := FALSE;
                              R370."Cell Value as Text" := "Fixed Asset"."No.";
                              R370.INSERT;
                              R370.VALIDATE("Column No.",3);
                              R370."Cell Value as Text" := "Fixed Asset".Description;
                              R370.INSERT;
                              R370.VALIDATE("Column No.",4);
                              //<<ISAT01.ISAT.SC
                              //R370."Cell Value as Text" := FORMAT(-BookValue);
                              R370."Cell Value as Text" := FORMAT(BookValue,0,1);
                              //>>ISAT01.ISAT.SC
                              R370.INSERT;
                              R370.VALIDATE("Column No.",5);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[1],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",6);
                              //<<ISAT01.ISAT.SC
                              //R370."Cell Value as Text" := FORMAT(BookValue - DeprAmount[1]);
                              R370."Cell Value as Text" := FORMAT(BookValue + DeprAmount[1],0,1);
                              //>>ISAT01.ISAT.SC
                              R370.INSERT;
                              R370.VALIDATE("Column No.",7);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[2],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",8);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[1] + DeprAmount[2],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",9);
                              R370."Cell Value as Text" := FORMAT(BookValue + DeprAmount[1] + DeprAmount[2],0,1);
                              R370.INSERT;
                              VLine += 1;
                           END;
                         END;

        ReqFilterFields=No.,FA Class Code,FA Subclass Code,Budgeted Asset;
        GroupTotalFields=FA Class Code,FA Subclass Code,Global Dimension 1 Code,Global Dimension 2 Code,FA Location Code,Component of Main Asset,FA Posting Group;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=18600;
            SectionHeight=4653;
          }
          CONTROLS
          {
            { 1000000002;TextBox;11100;846  ;7500 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 1000000003;TextBox;0    ;846  ;7500 ;423  ;FontSize=10;
                                                         FontBold=Yes;
                                                         SourceExpr=COMPANYNAME }
            { 1000000004;TextBox;18150;423  ;450  ;423  ;CaptionML=[ENU=Page;
                                                                    FRA=Page];
                                                         SourceExpr=CurrReport.PAGENO }
            { 1000000014;Label  ;17400;423  ;750  ;423  ;ParentControl=1000000004 }
            { 1000000015;TextBox;0    ;423  ;7500 ;423  ;SourceExpr=DeprBookText }
            { 1000000016;TextBox;11100;0    ;7500 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 1000000017;Label  ;0    ;0    ;7500 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Dotations Report;
                                                                    FRA=Immo. - Etat des dotations] }
            { 1000000018;TextBox;0    ;1692 ;18150;423  ;SourceExpr="Fixed Asset".TABLECAPTION + ': ' + FAFilter }
            { 1000000021;Shape  ;0    ;2538 ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1100281000;Label  ;14850;3384 ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Cumul Amort. }
            { 1000000012;Label  ;12900;3384 ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Amort. p‚riode }
            { 1000000005;Label  ;10950;3384 ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=VNC d‚but de p‚riode }
            { 1000000001;Label  ;9000 ;3384 ;1800 ;846  ;HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Cumul Amort. avt p‚riode }
            { 1000000022;TextBox;1800 ;3384 ;5100 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=FADescription }
            { 1000000023;TextBox;0    ;3384 ;1650 ;846  ;VertAlign=Bottom;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=FANo }
            { 1000000030;Shape  ;0    ;4230 ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1100281004;TextBox;7050 ;2961 ;1800 ;1269 ;FontSize=8;
                                                         MultiLine=Yes;
                                                         SourceExpr='Valeur d''acquisition ' + FORMAT(EndingDate) }
            { 1100281005;TextBox;9000 ;2961 ;3750 ;423  ;FontSize=8;
                                                         SourceExpr='.. ' + FORMAT(CALCDATE('-1J',StartingDate)) }
            { 1100281006;TextBox;12900;2961 ;3750 ;423  ;FontSize=8;
                                                         SourceExpr=FORMAT(StartingDate) + '..' + FORMAT(EndingDate) }
            { 1100281007;TextBox;16800;2961 ;1800 ;1269 ;FontSize=8;
                                                         MultiLine=Yes;
                                                         SourceExpr='VNC ' + FORMAT(EndingDate) }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupHeader;
            SectionWidth=18600;
            SectionHeight=423;
            OnPreSection=BEGIN
                           MakeGroupHeadLine;
                           InitGroupTotals;
                           CurrReport.SHOWOUTPUT(PrintDetails AND (GroupTotals <> GroupTotals::" "));
                         END;

            OnPostSection=BEGIN
                            //isat ec 28/11/05 : saut de page par sous total
                            IF CurrReport.SHOWOUTPUT THEN BEGIN
                              IF FirstRec AND (GroupTotals <> GroupTotals::" ") THEN
                                CurrReport.NEWPAGE
                              ELSE
                                FirstRec := TRUE;

                            IF (CreateXl  AND XlSection) THEN
                            BEGIN
                               R370.INIT;
                               R370.VALIDATE("Row No.",VLine);
                               R370.VALIDATE("Column No.",2);
                               R370.Bold := TRUE;
                               R370."Cell Value as Text" := GroupHeadLine;
                               R370.INSERT;
                               VLine += 1;
                            END;
                            END;
                          END;

          }
          CONTROLS
          {
            { 26  ;TextBox      ;0    ;0    ;5400 ;423  ;FontSize=10;
                                                         FontBold=Yes;
                                                         SourceExpr=GroupHeadLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18600;
            SectionHeight=423;
          }
          CONTROLS
          {
            { 1000000043;TextBox;12900;0    ;1800 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000044;TextBox;16800;0    ;1800 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=BookValue +DeprAmount[1] +DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000045;TextBox;7050 ;0    ;1800 ;423  ;FontSize=8;
                                                         FontItalic=No;
                                                         SourceExpr=BookValue }
            { 1000000046;TextBox;9000 ;0    ;1800 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1] }
            { 1000000047;TextBox;10950;0    ;1800 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr=BookValue +DeprAmount[1];
                                                         AutoFormatType=1 }
            { 1000000048;TextBox;14850;0    ;1800 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1]+DeprAmount[2] }
            { 1000000049;TextBox;1650 ;0    ;5250 ;423  ;FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr="Fixed Asset".Description }
            { 1000000050;TextBox;0    ;0    ;1500 ;423  ;HorzAlign=Left;
                                                         FontSize=8;
                                                         FontBold=No;
                                                         SourceExpr="Fixed Asset"."No." }
          }
           }
        { PROPERTIES
          {
            SectionType=GroupFooter;
            SectionWidth=18600;
            SectionHeight=1269;
            KeepWithNext=No;
            OnPostSection=BEGIN
                            GroupAmountsDim[5] += GroupAmountsDim[5];
                            GroupAmountsDim[1] += GroupAmounts[1];
                            TotalBookValueDim[1] += TotalBookValue[1];

                            IF (CreateXl AND XlSection) THEN
                            BEGIN
                               R370.INIT;
                               R370.VALIDATE("Row No.",VLine);
                               R370.VALIDATE("Column No.",2);
                               R370.Bold := FALSE;
                               R370."Cell Value as Text" := Text002 + ': ' + GroupHeadLine;
                               R370.INSERT;
                               R370.VALIDATE("Column No.",4);
                               R370."Cell Value as Text" := FORMAT(FALE.Amount,0,1);
                               R370.INSERT;
                               R370.VALIDATE("Column No.",5);
                               R370."Cell Value as Text" := FORMAT(-BookValue,0,1);
                               R370.INSERT;
                               R370.VALIDATE("Column No.",6);
                               R370."Cell Value as Text" := FORMAT(FALE.Amount + BookValue,0,1);
                               R370.INSERT;
                               R370.VALIDATE("Column No.",7);
                               R370."Cell Value as Text" := FORMAT(-AssetAmounts[1],0,1);
                               R370.INSERT;
                               R370.VALIDATE("Column No.",8);
                               R370."Cell Value as Text" := FORMAT(BookValue + AssetAmounts[1],0,1);
                               R370.INSERT;
                               R370.VALIDATE("Column No.",9);
                               R370."Cell Value as Text" := FORMAT(EntryAmounts[1],0,1);
                               R370.INSERT;
                               VLine += 2;
                            END;
                          END;

          }
          CONTROLS
          {
            { 27  ;TextBox      ;0    ;0    ;5250 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=Text002 + ': ' + GroupHeadLine }
            { 1000000011;Shape  ;0    ;846  ;18600;423  ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
            { 1000000000;TextBox;12750;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000013;TextBox;16650;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=BookValue+DeprAmount[1] +DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000026;TextBox;14700;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1]+DeprAmount[2] }
            { 1000000027;TextBox;6900 ;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=BookValue }
            { 1000000028;TextBox;8850 ;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1] }
            { 1000000029;TextBox;10800;0    ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=BookValue +DeprAmount[1];
                                                         AutoFormatType=1 }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18600;
            SectionHeight=1269;
            KeepWithNext=No;
            OnPreSection=BEGIN
                           {IF (CreateXl) THEN
                           BEGIN
                              R370.INIT;
                              R370.VALIDATE("Row No.",VLine);
                              R370.VALIDATE("Column No.",2);
                              R370.Bold := FALSE;
                              R370."Cell Value as Text" := 'TOTAL';
                              R370.INSERT;
                              R370.VALIDATE("Column No.",4);
                              R370."Cell Value as Text" := FORMAT(FALE.Amount,0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",5);
                              R370."Cell Value as Text" := FORMAT(-BookValue,0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",6);
                              R370."Cell Value as Text" := FORMAT(FALE.Amount + BookValue,0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",7);
                              R370."Cell Value as Text" := FORMAT(-AssetAmounts[1],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",8);
                              R370."Cell Value as Text" := FORMAT(BookValue + AssetAmounts[1],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",9);
                              R370."Cell Value as Text" := FORMAT(EntryAmounts[1],0,1);
                              R370.INSERT;
                              VLine += 1;
                           END;}

                           IF (CreateXl) THEN
                           BEGIN
                              R370.INIT;
                              R370.VALIDATE("Row No.",VLine);
                              R370.VALIDATE("Column No.",2);
                              R370.Bold := FALSE;
                              R370."Cell Value as Text" := 'TOTAL';
                              R370.INSERT;
                              R370.VALIDATE("Column No.",4);
                              R370."Cell Value as Text" := FORMAT(BookValue,0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",5);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[1],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",6);
                              R370."Cell Value as Text" := FORMAT(BookValue + DeprAmount[1],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",7);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[2],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",8);
                              R370."Cell Value as Text" := FORMAT(DeprAmount[1] + DeprAmount[2],0,1);
                              R370.INSERT;
                              R370.VALIDATE("Column No.",9);
                              R370."Cell Value as Text" := FORMAT(BookValue + DeprAmount[1] + DeprAmount[2],0,1);
                              R370.INSERT;
                              VLine += 1;
                           END;
                         END;

          }
          CONTROLS
          {
            { 1000000024;TextBox;0    ;423  ;5250 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr='TOTAL' }
            { 1000000025;Shape  ;0    ;846  ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1000000042;Shape  ;0    ;0    ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1000000036;TextBox;16650;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=BookValue +DeprAmount[1] +DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000037;TextBox;14700;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1]+DeprAmount[2] }
            { 1000000038;TextBox;12750;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=DeprAmount[2];
                                                         AutoFormatType=1 }
            { 1000000039;TextBox;10800;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         SourceExpr=BookValue +DeprAmount[1];
                                                         AutoFormatType=1 }
            { 1000000040;TextBox;8850 ;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=DeprAmount[1] }
            { 1000000041;TextBox;6900 ;423  ;1950 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         FontItalic=No;
                                                         SourceExpr=BookValue }
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=CONST(1));
        DataItemVarName=ProjectionTotal;
      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18600;
            SectionHeight=0;
            OnPreSection=BEGIN
                           IF PrintAmountsPerDate THEN
                             CurrReport.NEWPAGE;
                         END;

          }
          CONTROLS
          {
          }
           }
      }
       }
    { PROPERTIES
      {
        DataItemTable=Table2000000026;
        DataItemTableView=SORTING(Number)
                          WHERE(Number=FILTER(1..));
        DataItemVarName=Buffer;
        OnPreDataItem=BEGIN
                        IF NOT  PrintAmountsPerDate THEN
                          CurrReport.BREAK;
                        FABufferProjection.RESET;

                        IF (CreateXl) THEN
                        BEGIN
                           XlLine(R370B);

                           R370B.INIT;
                           R370B.VALIDATE("Row No.",VLine);
                           R370B.VALIDATE("Column No.",1);
                           R370B.Bold := TRUE;
                           R370B."Cell Value as Text" := 'SynthŠse des cumuls d''Amortissments';
                           R370B.INSERT;
                           VLine += 1;

                           R370B.VALIDATE("Row No.",VLine);
                           R370B.VALIDATE("Column No.",1);
                           R370B.Bold := TRUE;
                           R370B."Cell Value as Text" := GroupCodeName2;
                           R370B.INSERT;
                           R370B.VALIDATE("Column No.",2);
                           R370B."Cell Value as Text" := 'Date de comptabilisation';
                           R370B.INSERT;
                           R370B.VALIDATE("Column No.",3);
                           R370B."Cell Value as Text" := 'Amortissment';
                           R370B.INSERT;
                           R370B.VALIDATE("Column No.",4);
                           R370B."Cell Value as Text" := 'Cumul amortissement';
                           R370B.INSERT;
                           VLine += 1;

                        END;
                      END;

        OnAfterGetRecord=BEGIN
                           IF Number = 1 THEN BEGIN
                             IF NOT FABufferProjection.FIND('-') THEN
                               CurrReport.BREAK;
                           END ELSE
                             IF FABufferProjection.NEXT = 0 THEN
                               CurrReport.BREAK;
                         END;

      }
      SECTIONS
      {
        { PROPERTIES
          {
            SectionType=Header;
            PrintOnEveryPage=Yes;
            SectionWidth=18600;
            SectionHeight=3384;
          }
          CONTROLS
          {
            { 68  ;TextBox      ;11100;0    ;7500 ;423  ;HorzAlign=Right;
                                                         SourceExpr=FORMAT(TODAY,0,4) }
            { 73  ;TextBox      ;18150;423  ;450  ;423  ;CaptionML=[ENU=Page;
                                                                    FRA=Page];
                                                         SourceExpr=CurrReport.PAGENO }
            { 74  ;Label        ;17400;423  ;750  ;423  ;ParentControl=73 }
            { 72  ;TextBox      ;11100;846  ;7500 ;423  ;HorzAlign=Right;
                                                         SourceExpr=USERID }
            { 76  ;TextBox      ;0    ;846  ;7500 ;423  ;FontSize=10;
                                                         FontBold=Yes;
                                                         SourceExpr=COMPANYNAME }
            { 77  ;TextBox      ;0    ;423  ;7500 ;423  ;SourceExpr=DeprBookText }
            { 64  ;TextBox      ;16350;2115 ;1650 ;423  ;Visible=No;
                                                         HorzAlign=Right;
                                                         VertAlign=Bottom;
                                                         FontBold=Yes;
                                                         MultiLine=Yes;
                                                         SourceExpr=Custom1Text }
            { 67  ;Label        ;150  ;1692 ;17850;423  ;HorzAlign=Center;
                                                         FontSize=11;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Projected Amounts per Date;
                                                                    FRA=Montants projet‚s par date] }
            { 66  ;Label        ;5700 ;2115 ;2250 ;846  ;ParentControl=65;
                                                         HorzAlign=Left;
                                                         VertAlign=Center;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         MultiLine=Yes }
            { 71  ;Label        ;8100 ;2115 ;4800 ;846  ;ParentControl=70;
                                                         HorzAlign=Right;
                                                         VertAlign=Center;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         MultiLine=Yes }
            { 78  ;TextBox      ;600  ;2115 ;4950 ;846  ;HorzAlign=Left;
                                                         VertAlign=Center;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         SourceExpr=GroupCodeName2 }
            { 91  ;Label        ;0    ;0    ;7500 ;423  ;FontSize=8;
                                                         FontBold=Yes;
                                                         CaptionML=[ENU=Dotations Report;
                                                                    FRA=Immo. - Etat des dotations] }
            { 1000000007;Label  ;13050;2115 ;4500 ;846  ;HorzAlign=Right;
                                                         VertAlign=Center;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         MultiLine=Yes;
                                                         CaptionML=FRA=Cumul Amortissement }
            { 1000000009;Shape  ;0    ;1269 ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
            { 1000000008;Shape  ;0    ;2961 ;18600;423  ;BorderWidth=2pt;
                                                         ShapeStyle=HorzLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Body;
            SectionWidth=18600;
            SectionHeight=846;
            OnPreSection=BEGIN
                           CumulAmort := CumulAmort +  -FABufferProjection.Depreciation;
                         END;

            OnPostSection=BEGIN
                            IF (CreateXl) THEN
                            BEGIN
                               R370B.VALIDATE("Column No.",1);
                               R370B.Bold := TRUE;
                               R370B."Cell Value as Text" := FABufferProjection."Code Name";
                               R370B.INSERT;
                               R370B.VALIDATE("Column No.",2);
                               R370B."Cell Value as Text" := FORMAT(FABufferProjection."FA Posting Date");
                               R370B.INSERT;
                               R370B.VALIDATE("Column No.",3);
                               R370B."Cell Value as Text" := FORMAT(-FABufferProjection.Depreciation,0,1);
                               R370B.INSERT;
                               R370B.VALIDATE("Column No.",4);
                               R370B."Cell Value as Text" := FORMAT(CumulAmort,0,1);
                               R370B.INSERT;
                               VLine += 1;
                            END;
                          END;

          }
          CONTROLS
          {
            { 65  ;TextBox      ;5700 ;0    ;2250 ;423  ;HorzAlign=Left;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         CaptionML=[ENU=FA Posting Date;
                                                                    FRA=Date compta. immo.];
                                                         SourceExpr=FABufferProjection."FA Posting Date" }
            { 70  ;TextBox      ;8100 ;0    ;4800 ;423  ;FontSize=11;
                                                         FontBold=No;
                                                         CaptionML=[ENU=Depreciation;
                                                                    FRA=Amortissement];
                                                         BlankZero=Yes;
                                                         SourceExpr=-FABufferProjection.Depreciation }
            { 63  ;TextBox      ;16200;0    ;1800 ;423  ;Visible=No;
                                                         CaptionML=[ENU=Custom1Text;
                                                                    FRA=TexteParam1];
                                                         BlankZero=Yes;
                                                         SourceExpr=FABufferProjection."Custom 1" }
            { 75  ;TextBox      ;600  ;0    ;4950 ;423  ;HorzAlign=Left;
                                                         FontSize=11;
                                                         FontBold=No;
                                                         SourceExpr=FABufferProjection."Code Name" }
            { 1000000006;TextBox;13050;0    ;4500 ;423  ;FontSize=11;
                                                         FontBold=No;
                                                         SourceExpr=CumulAmort }
            { 1000000010;Shape  ;0    ;423  ;18600;423  ;BorderWidth=1pt;
                                                         ShapeStyle=HorzLine }
          }
           }
        { PROPERTIES
          {
            SectionType=Footer;
            SectionWidth=18600;
            SectionHeight=0;
          }
          CONTROLS
          {
          }
           }
      }
       }
  }
  REQUESTFORM
  {
    PROPERTIES
    {
      Width=10230;
      Height=4730;
      SaveValues=Yes;
      OnOpenForm=BEGIN
                   IF DeprBookCode = '' THEN BEGIN
                     FASetup.GET;
                     DeprBookCode := FASetup."Default Depr. Book";
                   END;

                   //paramŠtres par d‚faut
                   PrintDetails := TRUE;
                   PeriodLength := 360;
                   DaysInFirstPeriod := 360;
                   PrintAmountsPerDate := TRUE;
                 END;

    }
    CONTROLS
    {
      { 1   ;Label        ;0    ;3080 ;3300 ;440  ;ParentControl=2 }
      { 2   ;TextBox      ;3410 ;3080 ;2750 ;440  ;CaptionML=[ENU=Group Totals;
                                                              FRA=Sous-totaux];
                                                   OptionCaptionML=[ENU=" ,FA Class,FA Subclass,FA Location,Main Asset,Global Dimension 1,Global Dimension 2,FA Posting Group";
                                                                    FRA=" ,Classe immo.,Sous-classe immo.,Emplacement immo.,Immo. principale,Axe principal 1,Axe principal 2,Groupe compta. immo."];
                                                   NextControl=21;
                                                   SourceExpr=GroupTotals }
      { 12  ;Label        ;0    ;660  ;3300 ;440  ;ParentControl=14 }
      { 13  ;Label        ;0    ;1210 ;3300 ;440  ;ParentControl=15 }
      { 14  ;TextBox      ;3410 ;660  ;1650 ;440  ;CaptionML=[ENU=First Depreciation Date;
                                                              FRA=Date premier amortissement];
                                                   SourceExpr=StartingDate }
      { 15  ;TextBox      ;3410 ;1210 ;1650 ;440  ;CaptionML=[ENU=Last Depreciation Date;
                                                              FRA=Date dernier amortissement];
                                                   SourceExpr=EndingDate }
      { 18  ;Label        ;6380 ;0    ;3300 ;440  ;ParentControl=21 }
      { 21  ;CheckBox     ;9790 ;0    ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=Print per Fixed Asset;
                                                              FRA=Imprimer par immobilisation];
                                                   SourceExpr=PrintDetails }
      { 3   ;TextBox      ;3410 ;0    ;2750 ;440  ;CaptionML=[ENU=Depreciation Book;
                                                              FRA=Lois d'amortissement];
                                                   SourceExpr=DeprBookCode;
                                                   TableRelation="Depreciation Book" }
      { 4   ;Label        ;0    ;0    ;3300 ;440  ;ParentControl=3 }
      { 5   ;TextBox      ;3410 ;1870 ;1650 ;440  ;CaptionML=[ENU=Number of Days;
                                                              FRA=Nombre de jours];
                                                   BlankZero=Yes;
                                                   SourceExpr=PeriodLength;
                                                   MinValue=0;
                                                   OnValidate=BEGIN
                                                                IF PeriodLength > 0 THEN
                                                                  UseAccountingPeriod := FALSE;
                                                              END;
                                                               }
      { 6   ;Label        ;0    ;1870 ;3300 ;440  ;ParentControl=5 }
      { 7   ;CheckBox     ;9790 ;1100 ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=Print Amounts per Date;
                                                              FRA=Imprimer montants par date];
                                                   SourceExpr=PrintAmountsPerDate }
      { 8   ;Label        ;6380 ;1100 ;3300 ;440  ;ParentControl=7 }
      { 9   ;CheckBox     ;9790 ;550  ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=Projected Disposal;
                                                              FRA=Cession pr‚vue];
                                                   SourceExpr=ProjectedDisposal }
      { 10  ;Label        ;6380 ;550  ;3300 ;440  ;ParentControl=9 }
      { 17  ;TextBox      ;3410 ;2420 ;1650 ;440  ;CaptionML=[ENU=No. of Days in First Period;
                                                              FRA=Nombre de jours dans premiŠre p‚riode];
                                                   BlankZero=Yes;
                                                   SourceExpr=DaysInFirstPeriod;
                                                   MinValue=0 }
      { 19  ;Label        ;0    ;2420 ;3300 ;440  ;ParentControl=17 }
      { 20  ;CheckBox     ;9790 ;1650 ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=Use Accounting Period;
                                                              FRA=Utiliser p‚riode comptable];
                                                   SourceExpr=UseAccountingPeriod;
                                                   OnValidate=BEGIN
                                                                IF UseAccountingPeriod THEN BEGIN
                                                                  PeriodLength := 0;
                                                                //ec 05/10/05
                                                                  UseToDateSituation := FALSE;
                                                                  CLEAR(ToDate);
                                                                END;
                                                              END;
                                                               }
      { 22  ;Label        ;6380 ;1650 ;3300 ;440  ;ParentControl=20 }
      { 1100281002;CheckBox;9790;2200 ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=[ENU=To Date Annual Situation;
                                                              FRA=Situation annuelle … date];
                                                   SourceExpr=UseToDateSituation;
                                                   OnValidate=BEGIN
                                                                IF UseToDateSituation THEN
                                                                  UseAccountingPeriod := FALSE;
                                                              END;
                                                               }
      { 1100281003;Label  ;6380 ;2200 ;3300 ;440  ;ParentControl=1100281002 }
      { 1100281000;TextBox;8580 ;2860 ;1650 ;440  ;CaptionML=[ENU=Situation Date;
                                                              FRA=Date situation];
                                                   SourceExpr=ToDate;
                                                   OnValidate=VAR
                                                                year@1100281000 : Integer;
                                                                day@1100281001 : Integer;
                                                                month@1100281002 : Integer;
                                                              BEGIN
                                                                year := DATE2DMY(StartingDate,3);
                                                                month := DATE2DMY(ToDate,2);
                                                                day := DATE2DMY(ToDate,1);
                                                                IF DATE2DMY(ToDate,3) <> year THEN
                                                                  ToDate := DMY2DATE(day,month,year);
                                                              END;
                                                               }
      { 1100281001;Label  ;6380 ;2860 ;2090 ;440  ;ParentControl=1100281000 }
      { 1000000000;CheckBox;3410;3740 ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=FRA=Export vers Excel;
                                                   SourceExpr=CreateXl }
      { 1000000001;Label  ;0    ;3740 ;3300 ;440  ;ParentControl=1000000000 }
      { 1000000002;CheckBox;3410;4290 ;440  ;440  ;ShowCaption=No;
                                                   CaptionML=FRA=Export les ruptures vers Excel;
                                                   SourceExpr=XlSection }
      { 1000000003;Label  ;0    ;4290 ;3300 ;440  ;ParentControl=1000000002 }
    }
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Number of Days must not be greater than %1 or less than 5.;FRA=Le nombre de jours ne doit pas ˆtre sup‚rieur … %1 ou inf‚rieur … 5.';
      Text001@1001 : TextConst 'ENU=Projected Gain/Loss;FRA=Gains/Pertes pr‚vu(e)s';
      Text002@1002 : TextConst 'ENU=Group Total;FRA=Sous-total';
      Text003@1003 : TextConst 'ENU=Group Totals;FRA=Sous-totaux';
      Text004@1004 : TextConst 'ENU=%1 has been modified in fixed asset %2;FRA=%1 a ‚t‚ modifi‚(e) dans l''immobilisation %2';
      GLSetup@1100281009 : Record 98;
      FASetup@1005 : Record 5603;
      DeprBook@1006 : Record 5611;
      FADeprBook@1007 : Record 5612;
      FixedAsset@1100281015 : Record 5600;
      FA@1008 : Record 5600;
      FALedgEntry2@1009 : Record 5601;
      FABufferProjection@1010 : TEMPORARY Record 5641;
      FAGenReport@1011 : Codeunit 5626;
      CalculateDepr@1012 : Codeunit 5610;
      FADateCalc@1013 : Codeunit 5617;
      DepreciationCalc@1014 : Codeunit 5616;
      DeprBookCode@1015 : Code[10];
      FAFilter@1016 : Text[250];
      DeprBookText@1017 : Text[50];
      GroupCodeName@1018 : Text[50];
      GroupCodeName2@1019 : Text[50];
      GroupHeadLine@1020 : Text[50];
      DeprText@1021 : Text[50];
      DeprText2@1022 : Text[50];
      Custom1Text@1023 : Text[50];
      DeprCustom1Text@1024 : Text[50];
      FANo@1026 : Text[50];
      FADescription@1027 : Text[50];
      GroupTotals@1028 : ' ,FA Class,FA Subclass,FA Location,Main Asset,Global Dimension 1,Global Dimension 2,FA Posting Group';
      BookValue@1029 : Decimal;
      NewFiscalYear@1030 : Date;
      EndFiscalYear@1031 : Date;
      DaysInFiscalYear@1032 : Integer;
      Custom1DeprUntil@1033 : Date;
      PeriodLength@1034 : Integer;
      FirstToDate@1100281002 : Boolean;
      UseToDateSituation@1100281000 : Boolean;
      UseAccountingPeriod@1035 : Boolean;
      ToDate@1100281001 : Date;
      StartingDate@1036 : Date;
      StartingDate2@1037 : Date;
      EndingDate@1038 : Date;
      EndingDate2@1039 : Date;
      PrintAmountsPerDate@1040 : Boolean;
      OldUntilDate@1100281003 : Date;
      UntilDate@1041 : Date;
      PrintDetails@1042 : Boolean;
      EntryAmounts@1043 : ARRAY [4] OF Decimal;
      AssetAmounts@1044 : ARRAY [4] OF Decimal;
      GroupAmountsDim@1100281012 : ARRAY [6] OF Decimal;
      GroupAmounts@1045 : ARRAY [6] OF Decimal;
      TotalAmounts@1046 : ARRAY [6] OF Decimal;
      TotalBookValue@1047 : ARRAY [2] OF Decimal;
      TotalBookValueDim@1100281013 : ARRAY [2] OF Decimal;
      DateFromProjection@1048 : Date;
      DeprAmount@1049 : ARRAY [2] OF Decimal;
      TOTALDeprAmount@1100281010 : ARRAY [2] OF Decimal;
      Custom1Amount@1050 : Decimal;
      NumberOfDays@1051 : Integer;
      Custom1NumberOfDays@1052 : Integer;
      DaysInFirstPeriod@1053 : Integer;
      Done@1054 : Boolean;
      NotFirstGroupTotal@1055 : Boolean;
      SalesPriceFieldname@1056 : Text[50];
      GainLossFieldname@1057 : Text[50];
      ProjectedDisposal@1058 : Boolean;
      DoProjectedDisposal@1059 : Boolean;
      EntryPrinted@1060 : Boolean;
      Text005@1061 : TextConst 'ENU=" ,FA Class,FA Subclass,FA Location,Main Asset,Global Dimension 1,Global Dimension 2,FA Posting Group";FRA=" ,Classe immo.,Sous-classe immo.,Emplacement immo.,Immo. principale,Axe principal 1,Axe principal 2,Groupe compta. immo."';
      Cumul@1000000000 : Decimal;
      CumulAmort@1000000001 : Decimal;
      "---ID-VarG---"@1000000002 : Integer;
      FALE@1000000003 : Record 5601;
      Text006@1100281005 : TextConst 'FRA=Axe Principal 1 est d‚j… utilis‚ dans Sous-totaux analytiques';
      Text007@1100281006 : TextConst 'FRA=Axe Principal 2 est d‚j… utilis‚ dans Sous-totaux analytiques';
      Text008@1100281008 : TextConst 'FRA=Axe Principal 1 est d‚j… utilis‚ dans Sous-totaux';
      Text009@1100281007 : TextConst 'FRA=Axe Principal 2 est d‚j… utilis‚ dans Sous-totaux';
      Text010@1100281011 : TextConst 'FRA=Sous-totaux analytiques : %1';
      FirstRec@1100281004 : Boolean;
      EndingAmount@1100281014 : Decimal;
      BeforeAmount@1100281016 : Decimal;
      R370@1000000009 : TEMPORARY Record 370;
      R370B@1000000010 : TEMPORARY Record 370;
      VLine@1000000008 : Integer;
      VColumn@1000000007 : Integer;
      CreateXl@1000000006 : Boolean;
      CreateHeader@1000000005 : Boolean;
      "fa setup"@1000000004 : Record 5603;
      XlSection@1000000011 : Boolean;
      Year365Days@1100481000 : Boolean;

    LOCAL PROCEDURE SkipRecord@5() : Boolean;
    BEGIN
      EXIT(
        "Fixed Asset".Inactive OR
        (FADeprBook."Acquisition Date" = 0D) OR
        (FADeprBook."Acquisition Date" > EndingDate) OR
        (FADeprBook."Last Depreciation Date" > EndingDate) OR
        (FADeprBook."Disposal Date" > 0D));
    END;

    LOCAL PROCEDURE TransferValues@3();
    BEGIN
      WITH FADeprBook DO BEGIN
        CALCFIELDS("Book Value",Depreciation,"Custom 1");
        DateFromProjection := 0D;
        EntryAmounts[1] := "Book Value";
        EntryAmounts[2] := "Custom 1";
        EntryAmounts[3] :=
          DepreciationCalc.DeprInFiscalYear("Fixed Asset"."No.",DeprBookCode,StartingDate);
        TotalBookValue[1] := TotalBookValue[1] + "Book Value";
        TotalBookValue[2] := TotalBookValue[2] + "Book Value";
        NewFiscalYear := FADateCalc.GetFiscalYear(DeprBookCode,StartingDate);
        EndFiscalYear := FADateCalc.CalculateDate(
            DepreciationCalc.Yesterday(NewFiscalYear,Year365Days),DaysInFiscalYear,Year365Days);
        IF DeprBook."Use Custom 1 Depreciation" THEN
          Custom1DeprUntil := FADeprBook."Depr. Ending Date (Custom 1)"
        ELSE
          Custom1DeprUntil := 0D;

        IF Custom1DeprUntil > 0D THEN
          EntryAmounts[4] := GetDeprBasis;
      END;
      UntilDate := 0D;
      AssetAmounts[1] := 0;
      AssetAmounts[2] := 0;
      AssetAmounts[3] := 0;
      AssetAmounts[4] := 0;
    END;

    LOCAL PROCEDURE GetNextDate@13();
    VAR
      UntilDate2@1000 : Date;
    BEGIN
      IF UseToDateSituation AND (UntilDate<ToDate) THEN
        UntilDate := ToDate;

      UntilDate2 := GetPeriodEndingDate(UseAccountingPeriod,UntilDate,PeriodLength);

      IF Custom1DeprUntil > 0D THEN
        IF (UntilDate < Custom1DeprUntil) AND (UntilDate2 > Custom1DeprUntil) THEN
          UntilDate2 := Custom1DeprUntil;

      //ec 05/10/05 : ajout de l'option situation annuelle … date
      IF NOT UseToDateSituation THEN BEGIN
        IF (UntilDate < EndFiscalYear) AND (UntilDate2 > EndFiscalYear) THEN
          UntilDate2 := EndFiscalYear;
      END;

      IF UntilDate = EndFiscalYear THEN BEGIN
        EntryAmounts[3] := 0;
        NewFiscalYear := DepreciationCalc.ToMorrow(EndFiscalYear,Year365Days);
        EndFiscalYear := FADateCalc.CalculateDate(EndFiscalYear,DaysInFiscalYear,Year365Days);
      END;

      DateFromProjection := DepreciationCalc.ToMorrow(UntilDate,Year365Days);
      UntilDate := UntilDate2;
      IF (UntilDate >= EndingDate) THEN
        UntilDate := EndingDate;
    END;

    LOCAL PROCEDURE GetPeriodEndingDate@14(UseAccountingPeriod@1000 : Boolean;PeriodEndingDate@1001 : Date;VAR PeriodLength@1002 : Integer) : Date;
    VAR
      AccountingPeriod@1003 : Record 50;
      UntilDate2@1004 : Date;
    BEGIN
      IF NOT UseAccountingPeriod THEN
       EXIT(FADateCalc.CalculateDate(PeriodEndingDate,PeriodLength,Year365Days));
      AccountingPeriod.SETFILTER("Starting Date",'>=%1',DepreciationCalc.ToMorrow(PeriodEndingDate,Year365Days) + 1);
      IF AccountingPeriod.FIND('-') THEN BEGIN
        UntilDate2 := DepreciationCalc.Yesterday(AccountingPeriod."Starting Date",Year365Days);
        PeriodLength :=
          DepreciationCalc.DeprDays(DepreciationCalc.ToMorrow(PeriodEndingDate,Year365Days),UntilDate2,Year365Days);
        IF (PeriodLength <= 5) OR (PeriodLength > DaysInFiscalYear) THEN
          PeriodLength := DaysInFiscalYear;
        EXIT(UntilDate2);
      END ELSE
       EXIT(FADateCalc.CalculateDate(PeriodEndingDate,PeriodLength,Year365Days));
    END;

    LOCAL PROCEDURE MakeGroupTotalText@6();
    BEGIN
      CASE GroupTotals OF
        GroupTotals::"FA Class":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("FA Class Code");
        GroupTotals::"FA Subclass":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("FA Subclass Code");
        GroupTotals::"FA Location":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("FA Location Code");
        GroupTotals::"Main Asset":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("Main Asset/Component");
        GroupTotals::"Global Dimension 1":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("Global Dimension 1 Code");
        GroupTotals::"Global Dimension 2":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("Global Dimension 2 Code");
        GroupTotals::"FA Posting Group":
          GroupCodeName := "Fixed Asset".FIELDCAPTION("FA Posting Group");
      END;
      IF GroupCodeName <> '' THEN BEGIN
        GroupCodeName2 := GroupCodeName;
        IF GroupTotals = GroupTotals::"Main Asset" THEN
          GroupCodeName2 := STRSUBSTNO('%1',SELECTSTR(GroupTotals + 1,Text005));
        GroupCodeName := STRSUBSTNO('%1%2 %3',Text003,':',GroupCodeName2);
      END;
    END;

    LOCAL PROCEDURE ValidateDates@2();
    BEGIN
      FAGenReport.ValidateDeprDates(StartingDate,EndingDate);
      EndingDate2 := EndingDate;
      StartingDate2 := StartingDate;
    END;

    LOCAL PROCEDURE MakeGroupHeadLine@1();
    BEGIN
      WITH "Fixed Asset" DO BEGIN
        CASE GroupTotals OF
          GroupTotals::"FA Class":
            GroupHeadLine := "FA Class Code";
          GroupTotals::"FA Subclass":
            GroupHeadLine := "FA Subclass Code";
          GroupTotals::"FA Location":
            GroupHeadLine := "FA Location Code";
          GroupTotals::"Main Asset":
            BEGIN
              FA."Main Asset/Component" := FA."Main Asset/Component"::"Main Asset";
              GroupHeadLine :=
                STRSUBSTNO('%1 %2',FA."Main Asset/Component","Component of Main Asset");
              IF "Component of Main Asset" = '' THEN
                GroupHeadLine := STRSUBSTNO('%1%2',GroupHeadLine,'*****');
            END;
          GroupTotals::"Global Dimension 1":
            GroupHeadLine := "Global Dimension 1 Code";
          GroupTotals::"Global Dimension 2":
            GroupHeadLine := "Global Dimension 2 Code";
          GroupTotals::"FA Posting Group":
            GroupHeadLine := "FA Posting Group";
        END;
      END;
      IF GroupHeadLine = '' THEN
        GroupHeadLine := '*****';
    END;

    LOCAL PROCEDURE UpdateTotals@10();
    VAR
      EntryNo@1000 : Integer;
      CodeName@1001 : Code[20];
    BEGIN
    END;

    LOCAL PROCEDURE InitGroupTotals@4();
    BEGIN
      GroupAmounts[1] := 0;
      GroupAmounts[2] := 0;
      GroupAmounts[3] := 0;
      GroupAmounts[4] := 0;
      GroupAmounts[5] := 0;
      GroupAmounts[6] := 0;
      IF NotFirstGroupTotal THEN
        TotalBookValue[1] := 0
      ELSE
        TotalBookValue[1] := EntryAmounts[1];
      NotFirstGroupTotal := TRUE;
    END;

    LOCAL PROCEDURE GetDeprBasis@7() : Decimal;
    VAR
      FALedgEntry@1000 : Record 5601;
    BEGIN
      WITH FALedgEntry DO BEGIN
        SETCURRENTKEY("FA No.","Depreciation Book Code","Part of Book Value","FA Posting Date");
        SETRANGE("FA No.","Fixed Asset"."No.");
        SETRANGE("Depreciation Book Code",DeprBookCode);
        SETRANGE("Part of Book Value",TRUE);
        SETRANGE("FA Posting Date",0D,Custom1DeprUntil);
        CALCSUMS(Amount);
        EXIT(Amount);
      END;
    END;

    LOCAL PROCEDURE CalculateGainLoss@9();
    VAR
      EntryAmounts@1000 : ARRAY [14] OF Decimal;
      CalculateDisposal@1001 : Codeunit 5605;
    BEGIN
      CalculateDisposal.CalcGainLoss("Fixed Asset"."No.",DeprBookCode,EntryAmounts);
      AssetAmounts[3] := FADeprBook."Projected Proceeds on Disposal";
      IF EntryAmounts[1] <> 0 THEN
        AssetAmounts[4] := EntryAmounts[1]
      ELSE
        AssetAmounts[4] := EntryAmounts[2];
      AssetAmounts[4] :=
        AssetAmounts[4] + AssetAmounts[1] + AssetAmounts[2] - FADeprBook."Projected Proceeds on Disposal";
      GroupAmounts[3] := GroupAmounts[3] + AssetAmounts[3];
      GroupAmounts[4] := GroupAmounts[4] + AssetAmounts[4];
      TotalAmounts[3] := TotalAmounts[3] + AssetAmounts[3];
      TotalAmounts[4] := TotalAmounts[4] + AssetAmounts[4];
    END;

    LOCAL PROCEDURE CalculationDone@11(Done@1000 : Boolean;FirstDeprDate@1001 : Date) : Boolean;
    VAR
      TableDeprCalc@1002 : Codeunit 5618;
    BEGIN
      IF Done OR
        (FADeprBook."Depreciation Method" <> FADeprBook."Depreciation Method"::"User-Defined")
      THEN
        EXIT(Done);
      EXIT(
        TableDeprCalc.GetTablePercent(
          DeprBookCode,FADeprBook."Depreciation Table Code",
          FADeprBook."First User-Defined Depr. Date",FirstDeprDate,UntilDate) = 0);
    END;

    PROCEDURE "---ISAT---"@1000000000();
    BEGIN
    END;

    PROCEDURE XlLine@1100281001(VAR me@1000000000 : Record 370);
    VAR
      XlHead1@1000000001 : TextConst 'FRA=Liste des dotations';
    BEGIN
      FASetup.GET;
      IF CreateHeader AND FASetup."R50040.Init" THEN
      BEGIN
         me.INIT;
         me.VALIDATE("Row No.",1);
         me.VALIDATE("Column No.",1);
         me."Cell Value as Text" := XlHead1;
         me.INSERT;
         me.VALIDATE("Column No.",8);
         me."Cell Value as Text" := FORMAT(TODAY,0,'<Day> <Month text> <Year4>');
         me.Bold := TRUE;
         me.INSERT;
         me.VALIDATE("Row No.",2);
         me.VALIDATE("Column No.",1);
         me.Bold := TRUE;
         me."Cell Value as Text" := COMPANYNAME;
         me.Bold := TRUE;
         me.INSERT;
         me.Bold := FALSE;
         me.VALIDATE("Column No.",8);
         me."Cell Value as Text" := FORMAT(USERID);
         me.Bold := TRUE;
         me.INSERT;
         me.VALIDATE("Row No.",3);
         me.VALIDATE("Column No.",1);
         me."Cell Value as Text" := FORMAT(USERID);
         me.Bold := TRUE;
         me.INSERT;
      END;

      VLine := 5;
      CreateHeader := FALSE;
    END;

    BEGIN
    {
      /** @r ISA02 @d 07/07/09 @a ISAT.MA @v ISA6.00.00.01 @s Migration v6 **/
      /** @r ISA01 @d 07/07/09 @a ISAT.ST @v IMISAT6.00.00.01 @s Migration v6
          @c Ajout Year365Days + suivi */
    }
    END.
  }
  RDLDATA
  {
  }
}